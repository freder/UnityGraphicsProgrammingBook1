<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:ops="http://www.idpf.org/2007/ops" xml:lang="en" class="translated-ltr" style="height: 100%;"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <link rel="stylesheet" type="text/css" href="./Chapter 8 _ Space Filling_files/style.scss">
  <meta name="generator" content="Re:VIEW">
  <title>Space Filling</title>

			<style>
				img {
					max-width: 80vw;
					max-height: 80vh;
				}
			</style><style>
					.goog-te-banner-frame {
						display: none;
					}
				</style>
			<script>(function(){(function injection() {
  var pageLang = 'ja';
  var userLang = 'en';

  var uid = '1E07F158C6FA4460B352973E9693B329';
  var teId = 'TE_' + uid;
  var cbId = 'TECB_' + uid;

  function show() {
    window.setTimeout(function() {
      window[teId].showBanner(true);
    }, 10);
  }

  function newElem() {
    
  }

  if (window[teId]) {
    show();
  } else {
    if (!window.google || !google.translate ||
        !google.translate.TranslateElement) {
      if (!window[cbId]) {
        window[cbId] = function() {
          window[teId] = newElem();
          show();
        };
      }
      
    }
  }
})();})();</script><script src="https://translate.google.com/translate_a/element.js?cb=TECB_1E07F158C6FA4460B352973E9693B329&amp;client=tee&amp;hl=en"></script><script src="./Chapter 8 _ Space Filling_files/f.txt"></script><link type="text/css" rel="stylesheet" charset="UTF-8" href="https://translate.googleapis.com/translate_static/css/translateelement.css"><script type="text/javascript" charset="UTF-8" src="https://translate.googleapis.com/translate_static/js/element/main.js"></script><link type="text/css" rel="stylesheet" charset="UTF-8" href="./Chapter 8 _ Space Filling_files/translateelement.css"><script type="text/javascript" charset="UTF-8" src="./Chapter 8 _ Space Filling_files/main.js"></script><script type="text/javascript" charset="UTF-8" src="https://translate.googleapis.com/element/TE_20201130_00/e/js/element/element_main.js"></script><script type="text/javascript" charset="UTF-8" src="./Chapter 8 _ Space Filling_files/element_main.js"></script><script type="text/javascript" charset="UTF-8" src="https://translate.googleapis.com/element/TE_20201130_00/e/js/element/element_main.js"></script><link type="text/css" rel="stylesheet" charset="UTF-8" href="https://translate.googleapis.com/translate_static/css/translateelement.css"><script type="text/javascript" charset="UTF-8" src="https://translate.googleapis.com/translate_static/js/element/main.js"></script><script type="text/javascript" charset="UTF-8" src="https://translate.googleapis.com/element/TE_20201130_00/e/js/element/element_main.js"></script></head>
		
<body style="position: relative; min-height: 100%; top: 40px;"><div class="skiptranslate" style=""><iframe id=":0.container" class="goog-te-banner-frame skiptranslate" frameborder="0" src="javascript:''" style="visibility:visible"></iframe></div><div class="skiptranslate" style=""><iframe id=":0.container" class="goog-te-banner-frame skiptranslate" frameborder="0" src="javascript:''" style="visibility:visible"></iframe></div><div class="skiptranslate" style=""><iframe id=":0.container" class="goog-te-banner-frame skiptranslate" frameborder="0" src="javascript:''" style="visibility:visible"></iframe></div>
<h1><a id="h8"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chapter 8　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Space Filling</font></font></h1>

<h2><a id="h8-1"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Introduction</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This chapter </font><font style="vertical-align: inherit;">focuses on the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Space filling problem </font></font></b><a id="fnb-sp" href="https://freder.io/files/unity2/aoyama.html#fn-sp" class="noteref" epub:type="noteref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font><font style="vertical-align: inherit;">explains </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apollonian Gasket</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">which is one of the methods to solve it </font><font style="vertical-align: inherit;">.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since this chapter focuses on the algorithm explanation of Apollonius Gasket, it deviates a little from the story of graphic programming.</font></font></p>

<h2><a id="h8-2"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Space filling problem</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The space filling problem is the problem of finding a method to fill the inside of one closed plane as much as possible with a certain shape without overlapping. </font><font style="vertical-align: inherit;">This problem is an area that has been studied for a long time, especially in the fields of geometry and combinatorial optimization. </font><font style="vertical-align: inherit;">Since there are innumerable combinations of what kind of plane to fill with what kind of shape, various methods have been proposed for each combination.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To give a few examples</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rectangular packing </font></font><a id="fnb-rectangle" href="https://freder.io/files/unity2/aoyama.html#fn-rectangle" class="noteref" epub:type="noteref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">　: O-Tree method</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Polygonal packing </font></font><a id="fnb-polygon" href="https://freder.io/files/unity2/aoyama.html#fn-polygon" class="noteref" epub:type="noteref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Bottom-Left method</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Circle packing </font></font><a id="fnb-circle" href="https://freder.io/files/unity2/aoyama.html#fn-circle" class="noteref" epub:type="noteref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">　　: Apollonian Gasket</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Triangular packing </font></font><a id="fnb-triangle" href="https://freder.io/files/unity2/aoyama.html#fn-triangle" class="noteref" epub:type="noteref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Sierpinski Gasket</font></font></li>
</ul>
<div class="footnote" epub:type="footnote" id="fn-sp"><p class="footnote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[* 1] Other names such as "tessellation", "packing problem", and "packing problem" are used.</font></font></p></div>
<div class="footnote" epub:type="footnote" id="fn-rectangle"><p class="footnote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[* 2] Rectangular packing </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ cdots</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fill the rectangular plane with a rectangle</font></font></p></div>
<div class="footnote" epub:type="footnote" id="fn-polygon"><p class="footnote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[* 3] Polygon packing </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ cdots</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fill the rectangular plane with polygons</font></font></p></div>
<div class="footnote" epub:type="footnote" id="fn-circle"><p class="footnote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[* 4] Circle packing </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ cdots</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fill the inside of a circular plane with a circle</font></font></p></div>
<div class="footnote" epub:type="footnote" id="fn-triangle"><p class="footnote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[* 5] Triangular packing </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ cdots</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fill the triangular plane with triangles</font></font></p></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And so on, there are many other techniques. </font><font style="vertical-align: inherit;">In this chapter, we will explain about Apollonian Gasket among the above.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Space filling problem is known to be NP-hard, and it is currently difficult to always fill the plane 100% with any of the above algorithms. </font><font style="vertical-align: inherit;">The same is true for the Apollonian Gasket, which cannot completely fill the inside of a circle.</font></font></p>

<h2><a id="h8-3"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Apollonian Gasket</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Apollonian Gasket is a type of fractal figure generated from three circles that touch each other. </font><font style="vertical-align: inherit;">This is a kind of the earliest fractal figure, and it is said that one of the research results of plane geometry could be one solution of the Space filling problem, not the algorithm proposed to solve the Space filling problem. is. </font><font style="vertical-align: inherit;">The name is named after Apollonius of Perga, a Greek mortar in BC.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First, assuming that the three circles that touch each other are C1, C2, and C3, respectively, Apollonius discovered that there are two non-intersecting circles C4 and C5 that touch all of C1, C2, and C3. </font><font style="vertical-align: inherit;">These C4 and C5 are </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apollonius circles</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for C1, C2 and C3 </font><b><font style="vertical-align: inherit;">(details will be described later)</font></b><font style="vertical-align: inherit;"> .</font></font></p>
<div id="id_aoyama_2Fcircle1" class="image">
<img src="./Chapter 8 _ Space Filling_files/circle1.png" alt="C1, C2, C3 and the two circles C4, C5 in contact with it" class="width-080per">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figure 8.1: C1, C2, C3 and the two circles C4, C5 in contact with it
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now, if we consider C4 as opposed to C1, C2, we can get two new Apollonius circles for C1, C2, and C4. </font><font style="vertical-align: inherit;">Of these two circles, one will be C3 and the other will be the new circle C6.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Considering the Apollonius circles for all combinations, such as (C1, C2, C5), (C2, C3, C4), (C1, C3, C4), you can get at least one new circle for each. I can do it. </font><font style="vertical-align: inherit;">By repeating this infinitely, a set of circles that touch each other is created. </font><font style="vertical-align: inherit;">This set of circles is the Apollonian Gasket.</font></font></p>
<div id="id_aoyama_2Fapollonian__gasket" class="image">
<img src="./Chapter 8 _ Space Filling_files/apollonian_gasket.png" alt="Apollonian Gasket" class="width-090per">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figure 8.2: Apollonian Gasket
</font></font></p>
</div>
<p>https://upload.wikimedia.org/wikipedia/commons/e/e6/Apollonian_gasket.svg</p>
<div class="note">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Circles of Apollonius</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is the locus of the point P when the </font><font style="vertical-align: inherit;">    two fixed points A and B are taken and the point P is </font><font style="vertical-align: inherit;">taken so </font><font style="vertical-align: inherit;">that </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AP: BP = constant</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">However, apart from this, it refers to the solution to the Apollonius problem and is sometimes called the Apollonius circle, which has a stronger meaning in the Apollonius Gasket.</font></font></p>
</div>
<div class="note">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Problem of Apollonius</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">    In Euclidean geometry, the problem is to draw a fourth circle tangent to the given three circles. </font><font style="vertical-align: inherit;">It is said that there are a maximum of eight solutions for this fourth circle, two of which are always circumscribed at 3 yen, and two circles are always inscribed at 3 yen.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">    By the way, the three circles given as a condition do not have to touch each other, and the problem is to draw a fourth circle that touches the three circles.</font></font></p>
</div>

<h2><a id="h8-4"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Apollonian Gasket Calculation</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From here, I will explain the calculation method of Apollonian Gasket in order while looking at the actual program. </font><font style="vertical-align: inherit;">A sample program is available on Github, so please download it from there if necessary.</font></font></p>
<p>URL：<a href="https://github.com/IndieVisualLab/UnityGraphicsProgramming2" class="link">https://github.com/IndieVisualLab/UnityGraphicsProgramming2</a></p>

<h3><a id="h8-4-1"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.1　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Preparation</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In programming the Apollonian Gasket, this time we have prepared our own class to represent the circle and a structure to handle complex numbers.</font></font></p>
<p>　</p>
<div class="emlist-code">
<p class="caption">Circle.cs</p>
<pre class="emlist language-cs">using UnityEngine;<font></font>
<font></font>
public class Circle<font></font>
{<font></font>
    public float Curvature<font></font>
    {<font></font>
        get { return 1f / this.radius; }<font></font>
    }<font></font>
    public Complex Complex<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font></font></font><font></font>
        get; private set;<font></font>
    }<font></font>
    public float Radius<font></font>
    {<font></font>
        get { return Mathf.Abs(this.radius); }<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font></font></font><font></font>
    public Vector2 Position<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font></font></font><font></font>
        get { return this.Complex.Vec2; }<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font></font></font><font></font>
<font></font>
    private float radius = 0f;<font></font>
<font></font>
<font></font>
    public Circle(Complex complex, float radius)<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font></font></font><font></font>
        this.radius = radius;<font></font>
        this.Complex = complex;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font></font></font><font></font>
<font></font>
    /// ...<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    /// Below, a function to check the relationship between circles is implemented.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    /// Whether they are in contact, intersect, include, etc.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    /// ...</font></font></font></font><font></font>
}<font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Part of the implementation of a class that represents a circle.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you have basic programming knowledge, there should be nothing difficult. </font><font style="vertical-align: inherit;">In addition, </font></font><code class="tt">Complex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is a complex number structure prepared by myself this time </font><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">and is </font></font><code class="tt">Curvature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">called curvature, both of which are necessary values ​​for calculating the Apollonian Gasket.</font></font></p>
<p>　</p>
<div class="emlist-code">
<p class="caption">Complex.cs</p>
<pre class="emlist language-cs">using UnityEngine;<font></font>
using System;<font></font>
using System.Globalization;<font></font>
<font></font>
public struct Complex<font></font>
{<font></font>
    public static readonly Complex Zero = new Complex(0f, 0f);<font></font>
    public static readonly Complex One = new Complex(1f, 0f);<font></font>
    public static readonly Complex ImaginaryOne = new Complex(0f, 1f);<font></font>
<font></font>
    public float Real<font></font>
    {<font></font>
        get { return this.real; }<font></font>
    }<font></font>
    public float Imaginary<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font></font></font><font></font>
        get { return this.imaginary; }<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font></font></font><font></font>
    public float Magnitude<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font></font></font><font></font>
        get { return Abs(this); }<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font></font></font><font></font>
    public float SqrMagnitude<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font></font></font><font></font>
        get { return SqrAbs(this); }<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font></font></font><font></font>
    public float Phase<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font></font></font><font></font>
        get { return Mathf.Atan2(this.imaginary, this.real); }<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font></font></font><font></font>
    public Vector2 Vec2<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font></font></font><font></font>
        get { return new Vector2(this.real, this.imaginary); }<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font></font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    [SerializeField]</font></font></font></font><font></font>
    private float real;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    [SerializeField]</font></font></font></font><font></font>
    private float imaginary;<font></font>
<font></font>
<font></font>
    public Complex(Vector2 vec2) : this(vec2.x, vec2.y) { }<font></font>
<font></font>
    public Complex(Complex other) : this(other.real, other.imaginary) { }<font></font>
<font></font>
    public Complex(float real, float imaginary)<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font></font></font><font></font>
        this.real = real;<font></font>
        this.imaginary = imaginary;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font></font></font><font></font>
<font></font>
    /// ...<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    /// Below, the function to calculate the complex number is implemented.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    /// Four arithmetic operations, absolute value calculation, etc.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    /// ...</font></font></font></font><font></font>
}<font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A structure for handling complex numbers.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C # has a </font></font><code class="tt">Complex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">structure, but it has been included since .Net 4.0. </font><font style="vertical-align: inherit;">At the time of writing this chapter, Unity's .Net 4.6 support was in the Experimental stage, so I decided to prepare it myself.</font></font></p>

<h3><a id="h8-4-2"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.2　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Calculation of the first three circles</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As a prerequisite for calculating the Apollonian Gasket, there must be three circles tangent to each other. </font><font style="vertical-align: inherit;">Therefore, in this program, three circles with randomly determined radii are generated, and the coordinates are calculated and arranged so that they touch each other.</font></font></p>
<div class="emlist-code">
<p class="caption">ApollonianGaskets.cs</p>
<pre class="emlist language-cs">private void CreateFirstCircles(<font></font>
    out Circle c1, out Circle c2, out Circle c3)<font></font>
{<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    var r1 = Random.Range (</font></font></font></font><font></font>
        this.firstRadiusMin, this.firstRadiusMax<font></font>
    );<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    var r2 = Random.Range (</font></font></font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        this.firstRadiusMin, this.firstRadiusMax</font></font></font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    );</font></font></font></font><font></font>
    var r3 = Random.Range(<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        this.firstRadiusMin, this.firstRadiusMax</font></font></font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    );</font></font></font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    // Get random coordinates</font></font><font></font>
    var p1 = this.GetRandPosInCircle(<font></font>
        this.fieldRadiusMin,<font></font>
        this.fieldRadiusMax<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    );</font></font></font></font><font></font>
    c1 = new Circle(new Complex(p1), r1);<font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    // Calculate the center coordinates of the tangent circle based on p1</font></font><font></font>
    var p2 = -p1.normalized * ((r1 - p1.magnitude) + r2);<font></font>
    c2 = new Circle(new Complex(p2), r2);<font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    // Calculate the center coordinates of a circle tangent to two circles</font></font><font></font>
    var p3 = this.GetThirdVertex(p1, p2, r1 + r2, r2 + r3, r1 + r3);<font></font>
    c3 = new Circle(new Complex(p3), r3);<font></font>
}<font></font>
<font></font>
private Vector2 GetRandPosInCircle(float fieldMin, float fieldMax)<font></font>
{<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    // Get the right angle</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    var theta = Random.Range (0f, Mathf.PI * 2f);</font></font></font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    // Calculate the appropriate distance</font></font><font></font>
    var radius = Mathf.Sqrt(<font></font>
        2f * Random.Range(<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            0.5f * fieldMin * fieldMin,</font></font></font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
            0.5f * fieldMax * fieldMax</font></font></font></font><font></font>
        )<font></font>
    );<font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    // Convert from polar coordinate system to Euclidean plane</font></font><font></font>
    return new Vector2(<font></font>
        radius * Mathf.Cos(theta),<font></font>
        radius * Mathf.Sin(theta)<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    );</font></font></font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font></font></font><font></font>
<font></font>
private Vector2 GetThirdVertex(<font></font>
    Vector2 p1, Vector2 p2, float rab, float rbc, float rca)<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
{</font></font></font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    var p21 = p2 - p1;</font></font></font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    // Calculate the angle by the cosine theorem</font></font><font></font>
    var theta = Mathf.Acos(<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        (rab * rab + rca * rca - rbc * rbc) / (2f * rca * rab)</font></font></font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    );</font></font></font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    // Calculate and add the angle of the starting point</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    // theta is just an angle in the triangle, not an angle in the plane</font></font><font></font>
    theta += Mathf.Atan2(p21.y, p21.x);<font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    // Add the coordinates converted from the polar coordinate system to the Euclidean plane to the starting coordinates.</font></font><font></font>
    return p1 + new Vector2(<font></font>
        rca * Mathf.Cos(theta),<font></font>
        rca * Mathf.Sin(theta)<font></font>
    );<font></font>
}<font></font>
</pre>
</div>
<p><code class="tt">CreateFirstCircles</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By calling the function, the initial condition of 3 yen is generated.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Randomly into three radial first </font></font><code class="tt">r1,r2,r3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">decided, then </font></font><code class="tt">GetRandPosInCircle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the function </font></font><code class="tt">r1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to determine the center coordinates of a circle having a radius (hereinafter C1). </font><font style="vertical-align: inherit;">This function </font><font style="vertical-align: inherit;">returns random coordinates inside a circle that is </font></font><code class="tt">fieldMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">greater </font></font><code class="tt">fieldMax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">than </font><font style="vertical-align: inherit;">or </font><font style="vertical-align: inherit;">equal to </font><font style="vertical-align: inherit;">the radius of the origin center </font><font style="vertical-align: inherit;">.</font></font></p>
<div id="id_aoyama_2Fcircle2" class="image">
<img src="./Chapter 8 _ Space Filling_files/circle2.png" alt="Area where random coordinates are generated" class="width-080per">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figure 8.3: Area where random coordinates are generated
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next, </font></font><code class="tt">r2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the center coordinates of a circle with a radius (below C2) to calculate. </font><font style="vertical-align: inherit;">First </font><font style="vertical-align: inherit;">, calculate the distance from the origin to the center of C2 by </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(r1-p1.magnitude) + r2</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">By multiplying this by the normalized coordinates of C1 which is sign-inverted, </font></font><code class="tt">r2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the center coordinates of a circle with a radius </font><font style="vertical-align: inherit;">adjacent to C1 </font><font style="vertical-align: inherit;">can be obtained.</font></font></p>
<div id="id_aoyama_2Fcircle3" class="image">
<img src="./Chapter 8 _ Space Filling_files/circle3.png" alt="Position represented by p2 vector" class="width-080per">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figure 8.4: Position represented by the p2 vector
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"></font><code class="tt">r3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The center coordinates of the circle with the </font><font style="vertical-align: inherit;">last </font><font style="vertical-align: inherit;">radius (hereinafter C3) are </font></font><code class="tt">GetThirdVertex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calculated by the function, but this calculation uses the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cosine theorem</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">As most readers may have learned in high school, the cosine theorem is a theorem that holds between the length of the sides of a triangle and the cosine of an internal angle (cos). </font><font style="vertical-align: inherit;">△ in ABC, </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a = BC, b = CA, c = AB, alpha = ∠CAB</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> When</font></font></p>
<div class="equation">
<pre>a^2 = c^2 + b^2 - 2cbcosα
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is the law of cosines.</font></font></p>
<div id="id_aoyama_2Ftriangle" class="image">
<img src="./Chapter 8 _ Space Filling_files/triangle.png" alt="Triangle ABC" class="width-030per">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figure 8.5: Triangle ABC
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You may be wondering why you need a triangle to think about the center of a circle, but in fact, the relationship between the three circles makes it possible to think of a very easy-to-use triangle. </font><font style="vertical-align: inherit;">Considering a triangle whose apex is the center of C1, C2, and C3, since these three circles are in contact with each other, the length of each side of the triangle can be known from the radius of the circle.</font></font></p>
<div id="id_aoyama_2Fcircle4" class="image">
<img src="./Chapter 8 _ Space Filling_files/circle4.png" alt="Triangle ABC and circle C1, C2, C3" class="width-080per">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figure 8.6: Triangle ABC and Circles C1, C2, C3
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When the law of cosines is transformed</font></font></p>
<div class="equation">
<pre>cosα = \frac{c^2 + b^2 - a^2}{2cb}
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Therefore, we can solve the cosine from the lengths of the three sides. </font><font style="vertical-align: inherit;">Once the angle and distance between the two sides are found, the center coordinates of C3 can be found based on the center coordinates of C1. </font><font style="vertical-align: inherit;">..</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You have now generated the three tangent circles you need as an initial condition.</font></font></p>

<h3><a id="h8-4-3"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.3　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Calculation of the circle tangent to C1, C2, C3</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Based on the three circles C1, C2, and C3 generated in the previous section, the circles tangent to them are calculated. </font><font style="vertical-align: inherit;">Two parameters, radius and center coordinates, are required to create a new circle, so each is calculated.</font></font></p>

<h4><a id="h8-4-3-1"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">radius</font></font></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We first calculate from the radius, which can be calculated by </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descartes's circle theorem</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Descartes's circle theorem is that for four circles C1, C2, C3, C4 that touch each other, the curvature </font></font><a id="fnb-curvature" href="https://freder.io/files/unity2/aoyama.html#fn-curvature" class="noteref" epub:type="noteref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 6</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is k1, k2, k3, k4, respectively.</font></font></p>
<div class="equation">
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(k_1 + k_2 + k_3 + k_4) ^ 2 = 2 ({k_1} ^ 2 + {k_2} ^ 2 + {k_3} ^ 2 + {k_4} ^ 2)
</font></font></pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is true. </font><font style="vertical-align: inherit;">This is a quadratic equation for the radii of four circles, but if you organize this equation</font></font></p>
<div class="equation">
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k_4 = k_1 + k_2 + k_3 \ pm 2 \ sqrt {k_1k_2 + k_2k_3 + k_3k_1}
</font></font></pre>
</div>
<div class="footnote" epub:type="footnote" id="fn-curvature"><p class="footnote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[* 6] The reciprocal of the radius </font><font style="vertical-align: inherit;">, defined by </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k = \ pm \ frac {1} {r}</font></font></span><font style="vertical-align: inherit;"></font></p></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the three circles C1, C2, and C3 are known, the curvature of the fourth circle C4 can be obtained. </font><font style="vertical-align: inherit;">Since the curvature is the reciprocal of the radius, the radius of the circle can be known by taking the reciprocal of the curvature.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here, the curvature of C4 is obtained by compounding two, but one solution is always positive and the other is either positive or negative. </font><font style="vertical-align: inherit;">When the curvature of C4 is positive, it is circumscribed to C1, C2, C3, and when it is negative, it is inscribed to C1, C2, C3 (including 3 circles). </font><font style="vertical-align: inherit;">In other words, the fourth circle C4 can be considered in two patterns, and there is a possibility that both can be considered.</font></font></p>
<div id="id_aoyama_2Fcircle5" class="image">
<img src="./Chapter 8 _ Space Filling_files/circle5.png" alt="Positive or negative of curvature" class="width-080per">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figure 8.7: Positive and negative curvature
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The following part is programming this.</font></font></p>
<div class="emlist-code">
<p class="caption">SoddyCircles.cs</p>
<pre class="emlist language-cs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">// Curvature calculation</font></font><font></font>
var k1 = this.Circle1.Curvature;<font></font>
var k2 = this.Circle2.Curvature;<font></font>
var k3 = this.Circle3.Curvature;<font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
var plusK = k1 + k2 + k3 + 2f * Mathf.Sqrt (k1 * k2 + k2 * k3 + k3 * k1);</font></font></font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
var minusK = k1 + k2 + k3 - 2f * Mathf.Sqrt (k1 * k2 + k2 * k3 + k3 * k1);</font></font></font></font><font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This Cartesian circle theorem was later rediscovered by a chemist named Sodi, and the C1, C2, C3, and C4 circles are called Sodi's circles.</font></font></p>
<div class="note">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sodi's Circle and Apollonius' Circle</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">    In the previous section, we talked about the Circle of Apollonius, but I think some of you may have wondered what this is different from the Circle of Sodi.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">    The Apollonius circle is a general term for circles that solve the problems of Apollonius. </font><font style="vertical-align: inherit;">Sodi's circle is a term that refers to four circles that satisfy Descartes' circle theorem.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">    In other words, since Sodi's circle is one of the solutions to Apollonius' problem, it is also Apollonius's circle.</font></font></p>
</div>

<h4><a id="h8-4-3-2"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Center coordinates</font></font></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next is the calculation of the center coordinates, which is calculated </font><font style="vertical-align: inherit;">by </font><font style="vertical-align: inherit;">the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cartesian complex number theorem</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">which has a shape similar to the </font><b><font style="vertical-align: inherit;">Cartesian</font></b><font style="vertical-align: inherit;"> circle theorem </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The Cartesian complex number theorem is that the center coordinates of the circles C1, C2, C3, C4 that touch each other on the complex plane are z1, z2, z3, z4, and the curvature is k1, k2, k3, k4.</font></font></p>
<div class="equation">
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(k_1z_1 + k_2z_2 + k_3z_3 + k_4z_4) ^ 2 = 2 ({k_1} ^ 2 {z_1} ^ 2 + {k_2} ^ 2 {z_2} ^ 2 + {z_3} ^ 2 {z_3} ^ 2 + {k_4} ^ 2 {z_4} ^ 2)
</font></font></font></font></pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is true. </font><font style="vertical-align: inherit;">To organize this formula for z4</font></font></p>
<div class="equation">
<pre>z4 = \frac{z_1k_1 + z_2k_2 + z_3k_3 \pm 2\sqrt{k_1k_2z_1z_2 + k_2k_3z_2z_3 + k_3k_1z_3z_1}}{k4}
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since it can be transformed into, the center coordinates of the circle C4 can be obtained with this.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here, two curvatures were obtained when calculating the radius, but two can also be obtained by compounding the Cartesian complex number theorem. </font><font style="vertical-align: inherit;">However, unlike the curvature calculation, one of the two is the correct Sodi circle, so you need to determine which is correct.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The following part is programming this.</font></font></p>
<div class="emlist-code">
<p class="caption">SoddyCircles.cs</p>
<pre class="emlist language-cs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/// Calculation of center coordinates</font></font><font></font>
var ck1 = Complex.Multiply(this.Circle1.Complex, k1);<font></font>
var ck2 = Complex.Multiply(this.Circle2.Complex, k2);<font></font>
var ck3 = Complex.Multiply(this.Circle3.Complex, k3);<font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
var plusZ = ck1 + ck2 + ck3</font></font></font></font><font></font>
    + Complex.Multiply(Complex.Sqrt(ck1 * ck2 + ck2 * ck3 + ck3 * ck1), 2f);<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
var minusZ = ck1 + ck2 + ck3</font></font></font></font><font></font>
    - Complex.Multiply(Complex.Sqrt(ck1 * ck2 + ck2 * ck3 + ck3 * ck1), 2f);<font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
var recPlusK = 1f / plusK;</font></font></font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
var recMinusK = 1f / minusK;</font></font></font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
// Judgment of Sodi's circle</font></font><font></font>
this.GetGasket(<font></font>
    new Circle(Complex.Divide(plusZ, plusK), recPlusK),<font></font>
    new Circle(Complex.Divide(minusZ, plusK), recPlusK),<font></font>
    out c4<font></font>
);<font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
this.GetGasket(</font></font></font></font><font></font>
    new Circle(Complex.Divide(plusZ, minusK), recMinusK),<font></font>
    new Circle(Complex.Divide(minusZ, minusK), recMinusK),<font></font>
    out c5<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
);</font></font></font></font><font></font>
</pre>
</div>
<div class="emlist-code">
<p class="caption">SoddyCircles.cs</p>
<pre class="emlist language-cs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/// Judgment of Sodi's circle</font></font><font></font>
(c1.IsCircumscribed(c4, CalculationAccuracy)<font></font>
    || c1.IsInscribed(c4, CalculationAccuracy)) &amp;&amp;<font></font>
(c2.IsCircumscribed(c4, CalculationAccuracy)<font></font>
    || c2.IsInscribed(c4, CalculationAccuracy)) &amp;&amp;<font></font>
(c3.IsCircumscribed(c4, CalculationAccuracy)<font></font>
    || c3.IsInscribed(c4, CalculationAccuracy))<font></font>
</pre>
</div>
<div class="emlist-code">
<p class="caption">Circle.cs</p>
<pre class="emlist language-cs">public bool IsCircumscribed(Circle c, float accuracy)<font></font>
{<font></font>
    var d = (this.Position - c.Position).sqrMagnitude;<font></font>
    var abs = Mathf.Abs(d - Mathf.Pow(this.Radius + c.Radius, 2));<font></font>
<font></font>
    return abs &lt;= accuracy * accuracy;<font></font>
}<font></font>
<font></font>
public bool IsInscribed(Circle c, float accuracy)<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
{</font></font></font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    var d = (this.Position - c.Position).sqrMagnitude;</font></font></font></font><font></font>
    var abs = Mathf.Abs(d - Mathf.Pow(this.Radius - c.Radius, 2));<font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    return abs &lt;= accuracy * accuracy;</font></font></font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font></font></font><font></font>
</pre>
</div>
<p>　</p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now, based on the initial conditions C1, C2, C3, we have obtained two circles tangent to them (hereinafter C4, C5).</font></font></p>

<h3><a id="h8-4-4"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4.4　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Apollonian Gasket Calculation</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At this point, you can easily calculate the Apollonian Gasket. </font><font style="vertical-align: inherit;">Simply repeat the calculation performed in </font></font><a href="https://freder.io/files/unity2/aoyama.html#h8-4-3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"8.4.3 Calculation of the circle tangent to C1, C2, C3"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the previous section, </font><font style="vertical-align: inherit;">we found the circles C4 and C5 that are tangent to C1, C2 and C3 </font><font style="vertical-align: inherit;">found in </font></font><a href="https://freder.io/files/unity2/aoyama.html#h8-4-2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"8.4.2 Calculation of the first three circles"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Next, find the circles that touch (C1, C2, C4) (C1, C2, C5) (C2, C3, C4) (C2, C3, C5) (C3, C1, C4) (C3, C1, C5). I will continue.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here, even if the circles are in contact with each other on the combination, they may actually overlap with other circles. </font><font style="vertical-align: inherit;">Therefore, after determining whether it is the correct Sodi circle, it is also necessary to confirm that it does not overlap all the circles that have been requested so far.</font></font></p>
<div id="id_aoyama_2Fcircle6" class="image">
<img src="./Chapter 8 _ Space Filling_files/circle6.png" alt="Of the circles C7 and C8 that touch C1, C4 and C6, C8 overlaps with C2 and is not included in the Apollonian Gasket." class="width-080per">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figure 8.8: Of the circles C7 and C8 tangent to C1, C4 and C6, C8 overlaps C2 and is not included in the Apollonian Gasket.
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Then you will get a new circle that touches each one. </font><font style="vertical-align: inherit;">After that, in the same way, we will continue to find new tangent circles for all combinations of the original circle to find the tangent circle and the newly found tangent circle.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mathematically, the set of circles obtained by repeating this procedure infinitely is the Apollonian Gasket, but it is not possible to handle the program infinitely. </font><font style="vertical-align: inherit;">Therefore, in this program, if the radius of the newly obtained tangent circle is less than a certain value, the condition that the processing is completed is given for the combination.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The following part is programming this.</font></font></font></font></p>
<div class="emlist-code">
<p class="caption">ApollonianGaskets.cs</p>
<pre class="emlist language-cs">private void Awake()<font></font>
{<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    // Generate the initial condition of 3 yen</font></font><font></font>
    Circle c1, c2, c3;<font></font>
    this.CreateFirstCircles(out c1, out c2, out c3);<font></font>
    this.circles.Add(c1);<font></font>
    this.circles.Add(c2);<font></font>
    this.circles.Add(c3);<font></font>
<font></font>
    this.soddys.Enqueue(new SoddyCircles(c1, c2, c3));<font></font>
<font></font>
    while(this.soddys.Count &gt; 0)<font></font>
    {<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        // Calculate Sodi's circle</font></font><font></font>
        var soddy = this.soddys.Dequeue();<font></font>
<font></font>
        Circle c4, c5;<font></font>
        soddy.GetApollonianGaskets(out c4, out c5);<font></font>
<font></font>
        this.AddCircle(c4, soddy);<font></font>
        this.AddCircle(c5, soddy);<font></font>
    }<font></font>
}<font></font>
<font></font>
private void AddCircle(Circle c, SoddyCircles soddy)<font></font>
{<font></font>
    if(c == null || c.Radius &lt;= MinimumRadius)<font></font>
    {<font></font>
        return;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font></font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    // If the curvature is negative, no questions asked and added</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    // Circles with negative curvature appear only once</font></font><font></font>
    else if(c.Curvature &lt; 0f)<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font></font></font><font></font>
        this.circles.Add(c);<font></font>
        soddy.GetSoddyCircles(c).ForEach(s =&gt; this.soddys.Enqueue(s));<font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        return;</font></font></font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font></font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    // Check if it covers other circles</font></font><font></font>
    for(var i = 0; i &lt; this.circles.Count; i++)<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    {</font></font></font></font><font></font>
        var o = this.circles[i];<font></font>
<font></font>
        if(o.Curvature &lt; 0f)<font></font>
        {<font></font>
            continue;<font></font>
        }<font></font>
        else if(o.IsMatch(c, CalculationAccuracy) == true)<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        {</font></font></font></font><font></font>
            return;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        }</font></font></font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    }</font></font></font></font><font></font>
<font></font>
    this.circles.Add(c);<font></font>
    soddy.GetSoddyCircles(c).ForEach(s =&gt; this.soddys.Enqueue(s));<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font></font></font><font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You have now successfully requested the Apollonian Gasket.</font></font></p>
<div id="id_aoyama_2Fgasket" class="image">
<img src="./Chapter 8 _ Space Filling_files/gasket.png" alt="Execution result on Unity" class="width-100per">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figure 8.9: Execution result on Unity
</font></font></p>
</div>

<h2><a id="h8-5"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Summary</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So far, we have walked through the steps required to calculate the Apollonian Gasket. </font><font style="vertical-align: inherit;">As I explained at the beginning, the Apollonian Gasket has a stronger meaning as a fractal figure.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, if we remove the limitation of the plane this time and jump out into the world of space, it will become difficult to talk about it, and the meaning of filling (packing) from the fractal figure will become stronger. </font><font style="vertical-align: inherit;">The proposition of sphere-packing space is a field that has been controversial for hundreds of years, including the existence of famous mathematical conjectures such as the Kepler conjecture.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Space filling problem is also useful in practical terms. </font><font style="vertical-align: inherit;">It is applied in a wide range of fields such as optimization of VLSI layout design, optimization of cutting out parts such as cloth, and automation and optimization of UV development.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This time, I chose the Apollonian Gasket, which is relatively easy to understand and interesting. </font><font style="vertical-align: inherit;">If you are interested in packing itself, check out the algorithms introduced at the beginning.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fill the inside of the object with the object. </font><font style="vertical-align: inherit;">I think it can be used as a new expression method in unexpected places.</font></font></p>

<h2><a id="h8-6"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.6　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Reference</font></font></h2>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://ja.wikipedia.org/wiki/ Apollonian Gasket</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://ja.wikipedia.org/wiki/ Descartes' Circle Theorem</font></font></li>
<li>http://paulbourke.net/fractals/randomtile/</li>
</ul></body></html>