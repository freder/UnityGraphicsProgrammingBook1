<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:ops="http://www.idpf.org/2007/ops" xml:lang="en" class="translated-ltr" style="height: 100%;"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <link rel="stylesheet" type="text/css" href="./Chapter 4 _ Projection Spray_files/style.scss">
  <meta name="generator" content="Re:VIEW">
  <title>Projection Spray</title>

			<style>
				img {
					max-width: 80vw;
					max-height: 80vh;
				}
			</style><style>
					.goog-te-banner-frame {
						display: none;
					}
				</style>
			<script>(function(){(function injection() {
  var pageLang = 'ja';
  var userLang = 'en';

  var uid = '1E07F158C6FA4460B352973E9693B329';
  var teId = 'TE_' + uid;
  var cbId = 'TECB_' + uid;

  function show() {
    window.setTimeout(function() {
      window[teId].showBanner(true);
    }, 10);
  }

  function newElem() {
    
  }

  if (window[teId]) {
    show();
  } else {
    if (!window.google || !google.translate ||
        !google.translate.TranslateElement) {
      if (!window[cbId]) {
        window[cbId] = function() {
          window[teId] = newElem();
          show();
        };
      }
      
    }
  }
})();})();</script><script src="https://translate.google.com/translate_a/element.js?cb=TECB_1E07F158C6FA4460B352973E9693B329&amp;client=tee&amp;hl=en"></script><script src="./Chapter 4 _ Projection Spray_files/f.txt"></script><link type="text/css" rel="stylesheet" charset="UTF-8" href="https://translate.googleapis.com/translate_static/css/translateelement.css"><script type="text/javascript" charset="UTF-8" src="https://translate.googleapis.com/translate_static/js/element/main.js"></script><link type="text/css" rel="stylesheet" charset="UTF-8" href="./Chapter 4 _ Projection Spray_files/translateelement.css"><script type="text/javascript" charset="UTF-8" src="./Chapter 4 _ Projection Spray_files/main.js"></script><script type="text/javascript" charset="UTF-8" src="https://translate.googleapis.com/element/TE_20201130_00/e/js/element/element_main.js"></script><script type="text/javascript" charset="UTF-8" src="./Chapter 4 _ Projection Spray_files/element_main.js"></script><script type="text/javascript" charset="UTF-8" src="https://translate.googleapis.com/element/TE_20201130_00/e/js/element/element_main.js"></script><link type="text/css" rel="stylesheet" charset="UTF-8" href="https://translate.googleapis.com/translate_static/css/translateelement.css"><script type="text/javascript" charset="UTF-8" src="https://translate.googleapis.com/translate_static/js/element/main.js"></script><script type="text/javascript" charset="UTF-8" src="https://translate.googleapis.com/element/TE_20201130_00/e/js/element/element_main.js"></script></head>
		
<body style="position: relative; min-height: 100%; top: 40px;"><div class="skiptranslate" style=""><iframe id=":0.container" class="goog-te-banner-frame skiptranslate" frameborder="0" src="javascript:''" style="visibility:visible"></iframe></div><div class="skiptranslate" style=""><iframe id=":0.container" class="goog-te-banner-frame skiptranslate" frameborder="0" src="javascript:''" style="visibility:visible"></iframe></div><div class="skiptranslate" style=""><iframe id=":0.container" class="goog-te-banner-frame skiptranslate" frameborder="0" src="javascript:''" style="visibility:visible"></iframe></div>
<h1><a id="h4"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chapter 4　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Projection Spray</font></font></h1>

<h2><a id="h4-1"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Introduction</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hello! </font><font style="vertical-align: inherit;">It's Sugihiro Nori! </font><font style="vertical-align: inherit;">I'm sorry I couldn't write an article in the previous "UnityGraphicsPrograming Vol1"! </font><font style="vertical-align: inherit;">Thanks to Oishi-kun for writing on behalf of me (._.)</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here, I would like to explain the spray program that I could not write last time. </font><font style="vertical-align: inherit;">The code of Unity is a little better than the one at the time of Vol1!</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First, let's implement a simple lighting effect by ourselves without using Unity's Built-in lights. </font><font style="vertical-align: inherit;">Then, as an application, I will explain the development of the process of painting 3D objects with a spray. </font><font style="vertical-align: inherit;">The concept of this chapter is to follow the flow of creating your own functions by referring to UnityCG.cginc and built-in processing and applying them to new functions. </font><font style="vertical-align: inherit;">I think.</font></font></p>

<h3><a id="h4-1-1"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1.1　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sample repository</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The samples in this chapter are in </font><font style="vertical-align: inherit;">the ProjectionSpray folder at </font></font><br><a href="https://github.com/IndieVisualLab/UnityGraphicsProgramming2" class="link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/IndieVisualLab/UnityGraphicsProgramming2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></p>

<h2><a id="h4-2"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Implementation of Light Component</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Light in Unity is extremely useful. </font><font style="vertical-align: inherit;">Just install a light object and the world will be brighter. </font><font style="vertical-align: inherit;">When you select a shadow from the Inspector, a shadow map is automatically created and the shadow is cast from the object.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First of all, we will implement the light independently while watching how Unity implements the light.</font></font></p>

<h3><a id="h4-2-1"></a><span class="secno">4.2.1　</span>Unity Built-in Shader</h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In Unity, you can download the material shaders included by default and the internally used CGINC files from the Unity Download Archive.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It will be helpful when writing your own shader, and you can learn more about CG depiction, so I recommend you to download and see it!</font></font></p>
<div id="downloadBuilt-inShader" class="image">
<img src="./Chapter 4 _ Projection Spray_files/downloadBuilt-inShader.png" alt="https://unity3d.com/jp/get-unity/download/archive">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figure 4.1: https://unity3d.com/jp/get-unity/download/archive
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The writing-related files that may be relevant in this chapter are:</font></font></p>
<ul>
<li>CGIncludes/UnityCG.cginc</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CGIncludes / AutoLight.cginc</font></font></font></font></font></font></li>
<li>CGIncludes/Lighting.cginc</li>
<li>CGIncludes/UnityLightingCommon.cginc</li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's take a look at the basic Lambert Lighting. </font><font style="vertical-align: inherit;">( </font></font><span class="listref"><a href="https://freder.io/files/unity2/sugino.html#LightingLambert"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.1</font></font></a></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) Mr. Lambert thought.</font></font></p>
<div id="LightingLambert" class="code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.1: Lighting.cginc</font></font></p>
<pre class="list"> 1: struct SurfaceOutput {<font></font>
 2:     fixed3 Albedo;<font></font>
 3:     fixed3 Normal;<font></font>
 4:     fixed3 Emission;<font></font>
 5:     half Specular;<font></font>
 6:     fixed Gloss;<font></font>
 7:     fixed Alpha;<font></font>
 8: };<font></font>
 9: ~~<font></font>
10: inline fixed4 UnityLambertLight (SurfaceOutput s, UnityLight light)<font></font>
11: {<font></font>
12:     fixed diff = max (0, dot (s.Normal, light.dir));<font></font>
13: <font></font>
14:     fixed4 c;<font></font>
15:     c.rgb = s.Albedo * light.color * diff;<font></font>
16:     c.a = s.Alpha;<font></font>
17:     return c;<font></font>
18: }<font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the actual lighting calculation, the diffuse value is calculated from the inner product of the direction from the light to the mesh and the normal direction of the mesh. </font></font><span class="listref"><a href="https://freder.io/files/unity2/sugino.html#LightingLambert"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.1</font></font></a></span></p>
<p><code class="inline-code tt">fixed diff = max (0, dot (s.Normal, light.dir));</code></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For Unity Lights that are undefined in Lighting.cginc, they are defined in UnityLightingCommon.cginc and contain information about the color and direction of the lights. </font></font><span class="listref"><a href="https://freder.io/files/unity2/sugino.html#UnityLight"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.2</font></font></a></span></p>
<div id="UnityLight" class="code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.2: UnityLightingCommon.cginc</font></font></p>
<pre class="list"> 1: struct UnityLight<font></font>
 2: {<font></font>
 3:     half3 color;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 4: half3 you;</font></font><font></font>
 5: <font></font>
 6:     // Deprecated: Ndotl is now calculated on the fly<font></font>
 7:     // and is no longer stored. Do not used it.<font></font>
 8:     half  ndotl;<font></font>
 9: };<font></font>
</pre>
</div>

<h3><a id="h4-2-2"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2.2　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Displaying mesh normals</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Looking at the actual lighting process, I found that the calculation of lighting requires mesh normal information, so let's take a quick look at how to display mesh normal information in Shader. ..</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">See the scene in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00_viewNormal.unity</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the sample project </font><font style="vertical-align: inherit;">.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The object has a material that outputs normal information as a color, and its shader is shown in </font></font><span class="listref"><a href="https://freder.io/files/unity2/sugino.html#showNormal"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.3</font></font></a></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></p>
<div id="showNormal" class="code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.3: simple-showNormal.shader</font></font></p>
<pre class="list"> 1: struct appdata<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 2: {</font></font></font></font><font></font>
 3:     float4 vertex : POSITION;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 4: float3 normal: NORMAL;</font></font></font></font><font></font>
 5: };<font></font>
 6: <font></font>
 7: struct v2f<font></font>
 8: {<font></font>
 9:     float3 worldPos : TEXCOORD0;<font></font>
10:     float3 normal : TEXCOORD1;<font></font>
11:     float4 vertex : SV_POSITION;<font></font>
12: };<font></font>
13: <font></font>
14: v2f vert (appdata v)<font></font>
15: {<font></font>
16:     v2f o;<font></font>
17:     o.vertex = UnityObjectToClipPos(v.vertex);<font></font>
18:     o.normal = UnityObjectToWorldNormal(v.normal);<font></font>
19:     return o;<font></font>
20: }<font></font>
21: <font></font>
22: half4 frag (v2f i) : SV_Target<font></font>
23: {<font></font>
24:     fixed4 col = half4(i.normal,1);<font></font>
25:     return col;<font></font>
26: }<font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The vertex shader (v2f vert) calculates the normal direction of the mesh in the world coordinate system and passes it to the fragment shader (half4 frag). </font><font style="vertical-align: inherit;">In the fragment shader, the passed normal information is converted to color with the x component as R, the y component as G, and the z component as B, and output as it is. </font></font><span class="listref"><a href="https://freder.io/files/unity2/sugino.html#showNormal"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.3</font></font></a></span></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Even if the part looks black on the image, the normal x may actually have a negative value. </font></font><span class="imgref"><a href="https://freder.io/files/unity2/sugino.html#buddha_normal"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 4.2</font></font></a></span></p>
<div id="buddha_normal" class="image">
<img src="./Chapter 4 _ Projection Spray_files/buddha_normal.png" alt="00_viewNormal.unity">
<p class="caption">
図4.2: 00_viewNormal.unity
</p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The mesh is now ready for lighting.</font></font></p>
<div class="column">

<h3><a id="column-1"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Built-in shader helper function</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is a built-in utility function in UnityCG.cginc that makes it easy to write shaders. </font><font style="vertical-align: inherit;">For example, the </font><font style="vertical-align: inherit;">vertex position </font><font style="vertical-align: inherit;">used in </font></font><span class="listref"><a href="https://freder.io/files/unity2/sugino.html#showNormal"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.3</font></font></a></span><font style="vertical-align: inherit;"></font><code class="inline-code tt">UnityObjectToClipPos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> transforms from the object (local) coordinate system to the clip coordinate system. </font><font style="vertical-align: inherit;">Also, </font></font><code class="inline-code tt">UnityObjectToWorldNormal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the function of is converting the normal direction from the object coordinate system to the world coordinate system.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For other functions, please refer to UnityCG.cginc or the official manual as it is convenient for writing shaders. </font></font><a href="https://docs.unity3d.com/ja/current/Manual/SL-BuiltinFunctions.html" class="link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://docs.unity3d.com/ja/current/Manual/SL-BuiltinFunctions.html</font></font></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Also, if you want to know more about coordinate transformation and each coordinate system, you may be able to learn more by referring to Unity Graphics Programming vol.1 and Mr. Fukunaga's "Chapter 9 Multi Plane Perspective Projection".</font></font></p>
</div>

<h3><a id="h4-2-3"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2.3　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Point Light</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">See the scene at </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01_pointLight.unity</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the sample project </font><font style="vertical-align: inherit;">.</font></font></p>
<div id="scene-pointLight" class="image">
<img src="./Chapter 4 _ Projection Spray_files/scene-pointLight.png" alt="01_pointLight.unity">
<p class="caption">
図4.3: 01_pointLight.unity
</p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A point light source is a light source that illuminates all directions from a certain point. </font><font style="vertical-align: inherit;">The scene has a Buddha mesh object and a PointLight object. </font><font style="vertical-align: inherit;">The PointLight object has a script ( </font></font><span class="listref"><a href="https://freder.io/files/unity2/sugino.html#pointLight-cs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.4</font></font></a></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><font style="vertical-align: inherit;">for sending light information to the mesh, </font><font style="vertical-align: inherit;">and based on that light information, the lighting result is </font><font style="vertical-align: inherit;">displayed as a </font><font style="vertical-align: inherit;">material ( </font></font><span class="listref"><a href="https://freder.io/files/unity2/sugino.html#pointLight-shader"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.5</font></font></a></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font></p>
<div id="pointLight-cs" class="code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.4: PointLightComponent.cs</font></font></p>
<pre class="list"> 1: using UnityEngine;<font></font>
 2: <font></font>
 3: [ExecuteInEditMode]<font></font>
 4: public class PointLightComponent : MonoBehaviour<font></font>
 5: {<font></font>
 6:     static MaterialPropertyBlock mpb;<font></font>
 7: <font></font>
 8:     public Renderer targetRenderer;<font></font>
 9:     public float intensity = 1f;<font></font>
10:     public Color color = Color.white;<font></font>
11: <font></font>
12:     void Update()<font></font>
13:     {<font></font>
14:         if (targetRenderer == null)<font></font>
15:             return;<font></font>
16:         if (mpb == null)<font></font>
17:             mpb = new MaterialPropertyBlock();<font></font>
18: <font></font>
19:         targetRenderer.GetPropertyBlock(mpb);<font></font>
20:         mpb.SetVector("_LitPos", transform.position);<font></font>
21:         mpb.SetFloat("_Intensity", intensity);<font></font>
22:         mpb.SetColor("_LitCol", color);<font></font>
23:         targetRenderer.SetPropertyBlock(mpb);<font></font>
24:     }<font></font>
25: <font></font>
26:     private void OnDrawGizmos()<font></font>
27:     {<font></font>
28:         Gizmos.color = color;<font></font>
29:         Gizmos.DrawWireSphere(transform.position, intensity);<font></font>
30:     }<font></font>
31: }<font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This component passes the position, intensity and color of the light to the target mesh. </font><font style="vertical-align: inherit;">And, the material to perform the writing process is set based on the received information.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Values ​​are set from CSharp for each property </font><font style="vertical-align: inherit;">of </font></font><code class="inline-code tt">"_LitPos"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code class="inline-code tt">"_LitCol"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code class="inline-code tt">"_Intensity"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">of the </font><font style="vertical-align: inherit;">material </font><font style="vertical-align: inherit;">.</font></font></p>
<div id="pointLight-shader" class="code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.5: simple-pointLight.shader</font></font></p>
<pre class="list"> 1: Shader "Unlit/Simple/PointLight-Reciever"<font></font>
 2: {<font></font>
 3:     Properties<font></font>
 4:     {<font></font>
 5:         _LitPos("light position", Vector) = (0,0,0,0)<font></font>
 6:         _LitCol("light color", Color) = (1,1,1,1)<font></font>
 7:         _Intensity("light intensity", Float) = 1<font></font>
 8:     }<font></font>
 9:     SubShader<font></font>
10:     {<font></font>
11:         Tags { "RenderType"="Opaque" }<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
12: LOD 100</font></font></font></font><font></font>
13: <font></font>
14:         Pass<font></font>
15:         {<font></font>
16:             CGPROGRAM<font></font>
17:             #pragma vertex vert<font></font>
18:             #pragma fragment frag<font></font>
19: <font></font>
20:             #include "UnityCG.cginc"<font></font>
21: <font></font>
22:             struct appdata<font></font>
23:             {<font></font>
24:                 float4 vertex : POSITION;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
25: float3 normal: NORMAL;</font></font></font></font><font></font>
26:             };<font></font>
27: <font></font>
28:             struct v2f<font></font>
29:             {<font></font>
30:                 float3 worldPos : TEXCOORD0;<font></font>
31:                 float3 normal : TEXCOORD1;<font></font>
32:                 float4 vertex : SV_POSITION;<font></font>
33:             };<font></font>
34: <font></font>
35:             half4 _LitPos, _LitCol;<font></font>
36:             half _Intensity;<font></font>
37: <font></font>
38:             v2f vert (appdata v)<font></font>
39:             {<font></font>
40:                 v2f o;<font></font>
41:                 o.vertex = UnityObjectToClipPos(v.vertex);<font></font>
42:                 o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
43: // Pass the position of the mesh in the world coordinate system to the fragment shader</font></font><font></font>
44:                 o.normal = UnityObjectToWorldNormal(v.normal);<font></font>
45:                 return o;<font></font>
46:             }<font></font>
47: <font></font>
48:             fixed4 frag (v2f i) : SV_Target<font></font>
49:             {<font></font>
50:                 half3 to = i.worldPos - _LitPos;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
51: // Vector from light position to mesh position</font></font><font></font>
52:                 half3 lightDir = normalize(to);<font></font>
53:                 half dist = length(to);<font></font>
54:                 half atten =<font></font>
55:                     _Intensity * dot(-lightDir, i.normal) / (dist * dist);<font></font>
56: <font></font>
57:                 half4 col = max(0.0, atten) * _LitCol;<font></font>
58:                 return col;<font></font>
59:             }<font></font>
60:             ENDCG<font></font>
61:         }<font></font>
62:     }<font></font>
63: }<font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The lighting calculation is based on the basic Lambert Lighting ( </font></font><span class="listref"><a href="https://freder.io/files/unity2/sugino.html#LightingLambert"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.1</font></font></a></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) calculation, and the intensity is attenuated in inverse proportion to the square of the distance. </font></font><span class="listref"><a href="https://freder.io/files/unity2/sugino.html#pointLight-shader"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.5</font></font></a></span></p>
<p><code class="inline-code tt">half atten = _Intensity * dot(-lightDir, i.normal) / (dist * dist);</code></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It's a simple system of one light for one model, but I was able to implement the lighting process.</font></font></p>
<div id="buddha_pointLight" class="image">
<img src="./Chapter 4 _ Projection Spray_files/buddha_pointLight.png" alt="01_pointLight.unity">
<p class="caption">
図4.4: 01_pointLight.unity
</p>
</div>

<h3><a id="h4-2-4"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2.4　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SpotLight</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next, let's implement the spotlight. </font><font style="vertical-align: inherit;">Unlike point lights, spotlights are directional lights that emit light in one direction.</font></font></p>
<div id="scene-spotLight" class="image">
<img src="./Chapter 4 _ Projection Spray_files/scene-spotLight.png" alt="02_spotLight.unity">
<p class="caption">
図4.5: 02_spotLight.unity
</p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We are using standard Unity lights here just for the Gizmo display of the spotlights. </font></font><span class="imgref"><a href="https://freder.io/files/unity2/sugino.html#scene-spotLight"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 4.5</font></font></a></span></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since the spotlight is directional, the direction of the light and the spot angle (angle) information will be added to the point light in addition to the position information. </font><font style="vertical-align: inherit;">This information is of light </font></font><code class="inline-code tt">worldToLightMatrix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code class="inline-code tt">projectionMatrix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">respectively, as </font></font><code class="inline-code tt">Matrix4x4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(that's Shader </font></font><code class="inline-code tt">float4x4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Passes in the properties of).</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition, the spotlight can also set a Light Cookie. </font><font style="vertical-align: inherit;">(Unity has a default LightCookie, but I couldn't select it from the editor, so I'm using the Default-Particle texture)</font></font></p>
<div id="spotLight-csharp" class="code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.6: SpotLightComponent.cs</font></font></p>
<pre class="list"> 1: using UnityEngine;<font></font>
 2: <font></font>
 3: [ExecuteInEditMode]<font></font>
 4: public class SpotLightComponent : MonoBehaviour<font></font>
 5: {<font></font>
 6:     static MaterialPropertyBlock mpb;<font></font>
 7: <font></font>
 8:     public Renderer targetRenderer;<font></font>
 9:     public float intensity = 1f;<font></font>
10:     public Color color = Color.white;<font></font>
11:     [Range(0.01f, 90f)] public float angle = 30f;<font></font>
12:     public float range = 10f;<font></font>
13:     public Texture cookie;<font></font>
14: <font></font>
15:     void Update()<font></font>
16:     {<font></font>
17:         if (targetRenderer == null)<font></font>
18:             return;<font></font>
19:         if (mpb == null)<font></font>
20:             mpb = new MaterialPropertyBlock();<font></font>
21: <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
22: // Calculating projectionMatrix</font></font><font></font>
23:         var projMatrix = Matrix4x4.Perspective(angle, 1f, 0f, range);<font></font>
24:         var worldToLightMatrix = transform.worldToLocalMatrix;<font></font>
25: <font></font>
26:         targetRenderer.GetPropertyBlock(mpb);<font></font>
27:         mpb.SetVector("_LitPos", transform.position);<font></font>
28:         mpb.SetFloat("_Intensity", intensity);<font></font>
29:         mpb.SetColor("_LitCol", color);<font></font>
30:         mpb.SetMatrix("_WorldToLitMatrix", worldToLightMatrix);<font></font>
31:         mpb.SetMatrix("_ProjMatrix", projMatrix);<font></font>
32:         mpb.SetTexture("_Cookie", cookie);<font></font>
33:         targetRenderer.SetPropertyBlock(mpb);<font></font>
34:     }<font></font>
35: }<font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">projectionMatrix is </font></font><code class="inline-code tt">Matrix4x4.Perspective(angle, 1f, 0f, range)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">calculated by.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shader calculates and displays the lighting process based on the parameter information received from the spotlight. </font></font><span class="listref"><a href="https://freder.io/files/unity2/sugino.html#spotLight-shader"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.7</font></font></a></span></p>
<div id="spotLight-shader" class="code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.7: simple-spotLight.shader</font></font></p>
<pre class="list"> 1: uniform float4x4 _ProjMatrix, _WorldToLitMatrix;<font></font>
 2: <font></font>
 3: sampler2D _Cookie;<font></font>
 4: half4 _LitPos, _LitCol;<font></font>
 5: half _Intensity;<font></font>
 6: <font></font>
 7: ~~<font></font>
 8: <font></font>
 9: fixed4 frag (v2f i) : SV_Target<font></font>
10: {<font></font>
11:     half3 to = i.worldPos - _LitPos.xyz;<font></font>
12:     half3 lightDir = normalize(to);<font></font>
13:     half dist = length(to);<font></font>
14:     half atten = _Intensity * dot(-lightDir, i.normal) / (dist * dist);<font></font>
15: <font></font>
16:     half4 lightSpacePos = mul(_WorldToLitMatrix, half4(i.worldPos, 1.0));<font></font>
17:     half4 projPos = mul(_ProjMatrix, lightSpacePos);<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
18: projPos.z * = -1;</font></font></font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
19: half2 litUv = projPos.xy / projPos.z;</font></font></font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
20: litUv = litUv * 0.5 + 0.5;</font></font></font></font><font></font>
21:     half lightCookie = tex2D(_Cookie, litUv);<font></font>
22:     lightCookie *=<font></font>
23:         0&lt;litUv.x &amp;&amp; litUv.x&lt;1 &amp;&amp; 0&lt;litUv.y &amp;&amp; litUv.y&lt;1 &amp;&amp; 0&lt;projPos.z;<font></font>
24: <font></font>
25:     half4 col = max(0.0, atten) * _LitCol * lightCookie;<font></font>
26:     return col;<font></font>
27: }<font></font>
28: <font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can see that it's basically the same as a point light except for the fragment shader. </font></font><span class="listref"><a href="https://freder.io/files/unity2/sugino.html#spotLight-shader"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.7</font></font></a></span></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From the 16th line to the 22nd line, the intensity at each point of the spotlight is calculated. </font><font style="vertical-align: inherit;">When viewed from the position of the light, the light cookie at that point is sampled to determine whether the point is within the range of the light and the intensity of the light.</font></font></p>
<div id="buddha_spotLight" class="image">
<img src="./Chapter 4 _ Projection Spray_files/buddha_spotLight.png" alt="02_spotLight.unity">
<p class="caption">
図4.6: 02_spotLight.unity
</p>
</div>
<div class="column">

<h3><a id="column-2"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Handling of built-in cookies</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For the spotlight cookie processing, </font></font><code class="inline-code tt">UnitySpotCookie()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the part </font><font style="vertical-align: inherit;">in the built-in CGINC, AutoLight.cginc </font><font style="vertical-align: inherit;">will be helpful.</font></font></p>
<div id="UnitySpotCookie" class="code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.8: AutoLight.cginc</font></font></p>
<pre class="list"> 1: #ifdef SPOT<font></font>
 2: sampler2D _LightTexture0;<font></font>
 3: unityShadowCoord4x4 unity_WorldToLight;<font></font>
 4: sampler2D _LightTextureB0;<font></font>
 5: inline fixed UnitySpotCookie(unityShadowCoord4 LightCoord)<font></font>
 6: {<font></font>
 7:     return tex2D(<font></font>
 8:         _LightTexture0,<font></font>
 9:         LightCoord.xy / LightCoord.w + 0.5<font></font>
10:     ).w;<font></font>
11: }<font></font>
12: inline fixed UnitySpotAttenuate(unityShadowCoord3 LightCoord)<font></font>
13: {<font></font>
14:     return tex2D(<font></font>
15:         _LightTextureB0,<font></font>
16:         dot(LightCoord, LightCoord).xx<font></font>
17:     ).UNITY_ATTEN_CHANNEL;<font></font>
18: }<font></font>
19: #define UNITY_LIGHT_ATTENUATION(destName, input, worldPos) \<font></font>
20:     unityShadowCoord4 lightCoord = mul( \<font></font>
21:         unity_WorldToLight, \<font></font>
22:         unityShadowCoord4(worldPos, 1) \<font></font>
23:     ); \<font></font>
24:     fixed shadow = UNITY_SHADOW_ATTENUATION(input, worldPos); \<font></font>
25:     fixed destName = \<font></font>
26:         (lightCoord.z &gt; 0) * \<font></font>
27:         UnitySpotCookie(lightCoord) * \<font></font>
28:         UnitySpotAttenuate(lightCoord.xyz) * shadow;<font></font>
29: #endif<font></font>
</pre>
</div>
</div>

<h3><a id="h4-2-5"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2.5　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Shadow Shadow implementation</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finally, as a lighting implementation, let's implement a shadow.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Light comes out of the light, the mesh that is directly exposed to light becomes brighter, there is something else between the light and the mesh, and the mesh that is blocked by light becomes darker. </font><font style="vertical-align: inherit;">This is the shadow.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As a procedure, roughly</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create a depth texture as seen from the light.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When rendering an object, if the depth from the light at that point is greater than the depth texture, the point will be shadowed because it is blocked by other objects.</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It will be in the form of. </font><font style="vertical-align: inherit;">This time we need a depth texture from the position of the light, so we'll add a Camera component to SpotLight to create the depth texture as seen from the light.</font></font></p>
<div id="scene-spotShadow" class="image">
<pre class="dummyimage"></pre>
<p class="caption">
図4.7: 03_spotLight-withShadow.unity
</p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Camera (built-in) is attached to SpotLightComponent (self-made). </font></font><span class="imgref"><a href="https://freder.io/files/unity2/sugino.html#scene-spotShadow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 4.7</font></font></a></span></p>
<div id="spotShadow-csharp" class="code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.9: SpotLightWithShadow.cs</font></font></p>
<pre class="list"> 1: Shader depthRenderShader {<font></font>
 2:     get { return Shader.Find("Unlit/depthRender"); }<font></font>
 3: }<font></font>
 4: <font></font>
 5: new Camera camera<font></font>
 6: {<font></font>
 7:     get<font></font>
 8:     {<font></font>
 9:         if (_c == null)<font></font>
10:         {<font></font>
11:             _c = GetComponent&lt;Camera&gt;();<font></font>
12:             if (_c == null)<font></font>
13:                 _c = gameObject.AddComponent&lt;Camera&gt;();<font></font>
14:             depthOutput = new RenderTexture(<font></font>
15:                 shadowMapResolution,<font></font>
16:                 shadowMapResolution,<font></font>
17:                 16,<font></font>
18:                 RenderTextureFormat.RFloat<font></font>
19:             );<font></font>
20:             depthOutput.wrapMode = TextureWrapMode.Clamp;<font></font>
21:             depthOutput.Create();<font></font>
22:             _c.targetTexture = depthOutput;<font></font>
23:             _c.SetReplacementShader(depthRenderShader, "RenderType");<font></font>
24:             _c.clearFlags = CameraClearFlags.Nothing;<font></font>
25:             _c.nearClipPlane = 0.01f;<font></font>
26:             _c.enabled = false;<font></font>
27:         }<font></font>
28:         return _c;<font></font>
29:     }<font></font>
30: }<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
31: Room _c;</font></font><font></font>
32: RenderTexture depthOutput;<font></font>
33: <font></font>
34: void Update()<font></font>
35: {<font></font>
36:     if (mpb == null)<font></font>
37:         mpb = new MaterialPropertyBlock();<font></font>
38: <font></font>
39:     var currentRt = RenderTexture.active;<font></font>
40:     RenderTexture.active = depthOutput;<font></font>
41:     GL.Clear(true, true, Color.white * camera.farClipPlane);<font></font>
42:     camera.fieldOfView = angle;<font></font>
43:     camera.nearClipPlane = 0.01f;<font></font>
44:     camera.farClipPlane = range;<font></font>
45:     camera.Render();<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
46: // Camera rendering is done manually in the script</font></font><font></font>
47:     RenderTexture.active = currentRt;<font></font>
48: <font></font>
49:     var projMatrix = camera.projectionMatrix;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
50: // Use the camera's projection matrix</font></font><font></font>
51:     var worldToLightMatrix = transform.worldToLocalMatrix;<font></font>
52: <font></font>
53:     ~~<font></font>
54: }<font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The C # script is almost the same as the shadowless version, but with the camera set to render the depth texture and the ReplacementShader to render the depth. </font><font style="vertical-align: inherit;">Also, since we have a camera this time </font></font><code class="inline-code tt">Matrix4x4.Perspective</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code class="inline-code tt">Camera.projectionMatrix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we will use the </font><font style="vertical-align: inherit;">projection matrix </font><font style="vertical-align: inherit;">instead of </font><font style="vertical-align: inherit;">.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The shader for depth texture generation looks like this:</font></font></p>
<div id="depthRender" class="code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.10: depthRender.shader</font></font></p>
<pre class="list"> 1:     v2f vert (float4 pos : POSITION)<font></font>
 2:     {<font></font>
 3:         v2f o;<font></font>
 4:         o.vertex = UnityObjectToClipPos(pos);<font></font>
 5:         o.depth = abs(UnityObjectToViewPos(pos).z);<font></font>
 6:         return o;<font></font>
 7:     }<font></font>
 8: <font></font>
 9:     float frag (v2f i) : SV_Target<font></font>
10:     {<font></font>
11:         return i.depth;<font></font>
12:     }<font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The generated depth texture ( </font></font><span class="imgref"><a href="https://freder.io/files/unity2/sugino.html#depth"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 4.8</font></font></a></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) outputs the z-coordinate value of the position of the object in the light coordinate system (camera coordinate system).</font></font></p>
<div id="depth" class="image">
<img src="./Chapter 4 _ Projection Spray_files/depth.png" alt="light depthTexture">
<p class="caption">
図4.8: light depthTexture
</p>
</div>
<p><font style="vertical-align: inherit;"></font><code class="inline-code tt">depthOutput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pass the </font><font style="vertical-align: inherit;">generated depth texture ( </font><font style="vertical-align: inherit;">) to the mesh object and render the object. </font><font style="vertical-align: inherit;">The calculated part of the shadow of the object looks like this:</font></font></p>
<div id="spotShadow-shader" class="code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.11: simple-spotLight-withShadow.shader</font></font></p>
<pre class="list"> 1: fixed4 frag (v2f i) : SV_Target<font></font>
 2: {<font></font>
 3:     ///diffuse lighting<font></font>
 4:     half3 to = i.worldPos - _LitPos.xyz;<font></font>
 5:     half3 lightDir = normalize(to);<font></font>
 6:     half dist = length(to);<font></font>
 7:     half atten = _Intensity * dot(-lightDir, i.normal) / (dist * dist);<font></font>
 8: <font></font>
 9:     ///spot-light cookie<font></font>
10:     half4 lightSpacePos = mul(_WorldToLitMatrix, half4(i.worldPos, 1.0));<font></font>
11:     half4 projPos = mul(_ProjMatrix, lightSpacePos);<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
12: projPos.z * = -1;</font></font></font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
13: half2 litUv = projPos.xy / projPos.z;</font></font></font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
14: litUv = litUv * 0.5 + 0.5;</font></font></font></font><font></font>
15:     half lightCookie = tex2D(_Cookie, litUv);<font></font>
16:     lightCookie *=<font></font>
17:         0&lt;litUv.x &amp;&amp; litUv.x&lt;1 &amp;&amp; 0&lt;litUv.y &amp;&amp; litUv.y&lt;1 &amp;&amp; 0&lt;projPos.z;<font></font>
18: <font></font>
19:     ///shadow<font></font>
20:     half lightDepth = tex2D(_LitDepth, litUv).r;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
21: // _LitDepth is passed the depth texture seen from the light</font></font><font></font>
22:     atten *= 1.0 - saturate(10*abs(lightSpacePos.z) - 10*lightDepth);<font></font>
23: <font></font>
24:     half4 col = max(0.0, atten) * _LitCol * lightCookie;<font></font>
25:     return col;<font></font>
26: }<font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Made the depth texture by the camera </font></font><code class="inline-code tt">tex2D(_LitTexture, litUv).r</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code class="inline-code tt">lightSpacePos.z</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is, z value of the vertex position of both viewed from the light object is stored. </font><font style="vertical-align: inherit;">Since the texture is </font></font><code class="inline-code tt">_LitTexture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the information of the surface seen from the light = the surface exposed to the light, it is </font><font style="vertical-align: inherit;">judged whether it is a shadow or not by comparing it </font><font style="vertical-align: inherit;">with the value ( </font></font><code class="inline-code tt">lightDepth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">sampled from the depth texture </font></font><code class="inline-code tt">lightSpacePos.z</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
<p><code class="inline-code tt">atten *= 1.0 - saturate(10*abs(lightSpacePos.z) - 10*lightDepth);</code></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the code here, the </font></font><code class="inline-code tt">lightDepth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">higher </font></font><code class="inline-code tt">lightSpacePos.z</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the value, the darker the surface.</font></font></p>
<div id="buddha_spotShadow" class="image">
<img src="./Chapter 4 _ Projection Spray_files/buddha_spotShadow.png" alt="03_spotLight-withShadow.unity">
<p class="caption">
図4.9: 03_spotLight-withShadow.unity
</p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can now see the shadow of the object in the spotlight.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using this spotlight and shadow implementation, we will implement a spray function that colors objects in real time.</font></font></p>
<div class="column">

<h3><a id="column-3"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Camera.projectionMatrix and Matrix4x4.Perspective are the same matrix</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity scene: in Example, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">compareMatrix.unity</font></font></b></p>
<div id="matrix" class="code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.12: CompareMatrix.cs</font></font></p>
<pre class="list language-csharp"> 1:     float fov = 30f;<font></font>
 2:     float near = 0.01f;<font></font>
 3:     float far = 1000f;<font></font>
 4: <font></font>
 5:     camera.fieldOfView = fov;<font></font>
 6:     camera.nearClipPlane = near;<font></font>
 7:     camera.farClipPlane = far;<font></font>
 8: <font></font>
 9:     Matrix4x4 cameraMatrix = camera.projectionMatrix;<font></font>
10:     Matrix4x4 perseMatrix = Matrix4x4.Perspective(<font></font>
11:         fov,<font></font>
12:         1f,<font></font>
13:         near,<font></font>
14:         far<font></font>
15:     );<font></font>
</pre>
</div>
</div>

<h2><a id="h4-3"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Implementation of Projection Spray</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From here, we will apply our own SpotLightComponent to implement the spray function that allows you to paint objects.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Basically, it draws on the texture of the object based on the value of the lighting intensity. </font><font style="vertical-align: inherit;">Since the Buddha object used this time does not have uv data, it is not possible to paste the texture as it is, but Unity has a function to generate UV for LightMap.</font></font></p>
<div id="buddha-importSetting" class="image">
<img src="./Chapter 4 _ Projection Spray_files/buddha-importSetting.png" alt="buddha Import Setting">
<p class="caption">
図4.10: buddha Import Setting
</p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you check the "Generate Lightmap UVs" item in the model Import Setting, UVs for the lightmap will be generated. </font><font style="vertical-align: inherit;">( </font></font><code class="inline-code tt">v.uv2 : TEXCOORD1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) Create a drawable RenderTexture for this Uv2 and draw it.</font></font></p>

<h3><a id="h4-3-1"></a><span class="secno">4.3.1　</span>showUv2</h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">See </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00_showUv2.unity</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for a </font><font style="vertical-align: inherit;">sample scene </font><font style="vertical-align: inherit;">.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In order to write to the texture that maps to mesh.uv2, we need to generate a texture that is expanded from the mesh to UV2. </font><font style="vertical-align: inherit;">First, let's create a shader that expands the vertices of the mesh to the coordinates of UV2.</font></font></p>
<div id="scene-showUv2" class="image">
<img src="./Chapter 4 _ Projection Spray_files/scene-showUv2.png" alt="00_showUv2.unity">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figure 4.11: 00_showUv2.unity
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selecting a Buddha object in the scene and manipulating the material's "slider" parameter will change the object from its original shape to its Uv2 expanded shape. </font><font style="vertical-align: inherit;">Coloring is, </font></font><code class="inline-code tt">uv2.xy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wo </font></font><code class="inline-code tt">color.rg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">has been assigned to.</font></font></p>
<div id="showUv2-shader" class="code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.13: showUv2.shader</font></font></p>
<pre class="list"> 1: float _T;<font></font>
 2: <font></font>
 3: v2f vert(appdata v)<font></font>
 4: {<font></font>
 5: #if UNITY_UV_STARTS_AT_TOP<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 6: v.uv2.y = 1.0 - v.uv2.y;</font></font></font></font><font></font>
 7: #endif<font></font>
 8:     float4 pos0 = UnityObjectToClipPos(v.vertex);<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 9: float4 pos1 = float4 (v.uv2 * 2.0 - 1.0, 0.0, 1.0);</font></font></font></font><font></font>
10: <font></font>
11:     v2f o;<font></font>
12:     o.vertex = lerp(pos0, pos1, _T);<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
13: o.uv2 = v.uv2;</font></font></font></font><font></font>
14:     o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;<font></font>
15:     o.normal = UnityObjectToWorldNormal(v.normal);<font></font>
16:     return o;<font></font>
17: }<font></font>
18: <font></font>
19: half4 frag(v2f i) : SV_Target<font></font>
20: {<font></font>
21:     return half4(i.uv2,0,1);<font></font>
22: }<font></font>
</pre>
</div>
<p><code class="inline-code tt">float4 pos1 = float4(v.uv2*2.0 - 1.0, 0.0, 1.0);</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The value of is the position expanded to Uv2 in the clip coordinate system. </font></font><span class="listref"><a href="https://freder.io/files/unity2/sugino.html#showUv2-shader"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.13</font></font></a></span></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since we are passing the value </font><font style="vertical-align: inherit;">of </font></font><code class="inline-code tt">worldPos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and to </font></font><code class="inline-code tt">normal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the </font><font style="vertical-align: inherit;">fragment shader, </font><font style="vertical-align: inherit;">we </font><font style="vertical-align: inherit;">will use this value to handle the lighting in the spotlight calculation.</font></font></p>
<div id="buddha-uv2" class="image">
<img src="./Chapter 4 _ Projection Spray_files/buddha-uv2.png" alt="00_showUv2.unity">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figure 4.12: 00_showUv2.unity
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can generate textures expanded from mesh to Uv2!</font></font></p>

<h3><a id="h4-3-2"></a><span class="secno">4.3.2　</span>ProjectionSpray</h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now that we're ready, we'll implement the spray functionality. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">See</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the scene at </font><b><font style="vertical-align: inherit;">01_projectionSpray.unity</font></b><font style="vertical-align: inherit;"> .</font></font></p>
<div id="scene-spray" class="image">
<img src="./Chapter 4 _ Projection Spray_files/scene-spray.png" alt="01_projectionSpray.unity">
<p class="caption">
図4.13: 01_projectionSpray.unity
</p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As you run this scene, the black Buddha objects will gradually become colored. </font><font style="vertical-align: inherit;">Then, when you click on the screen, that part will be sprayed with a colorful color.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In terms of implementation content, it is an application of the self-made spotlight that has been implemented so far. </font><font style="vertical-align: inherit;">The spotlight lighting calculation is not used for lighting </font></font><code class="inline-code tt">RenderTexture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as it is, but is used for updating. </font><font style="vertical-align: inherit;">In this example, the texture you wrote is mapped to the one generated for the lightmap </font></font><code class="inline-code tt">mesh.uv2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
<p><code class="inline-code tt">Drawable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is a component attached to the object to be sprayed and is being drawn into the texture. </font></font><code class="inline-code tt">ProjectionSpray</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The component </font></font><code class="inline-code tt">Material</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sets properties </font><font style="vertical-align: inherit;">for drawing on the texture, such as the position of the spray </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">As the processing flow </font><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">we call </font><font style="vertical-align: inherit;">in </font></font><code class="inline-code tt">DrawableController</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the </font></font><code class="inline-code tt">Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">function of </font></font><code class="inline-code tt">projectionSpray.Draw(drawable)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and draw on the texture.</font></font></p>

<h4><a id="h4-3-2-1"></a>ProjectionSpray.cs</h4>
<ul>
<li><code class="inline-code tt">Material drawMat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Material for drawing</font></font></li>
<li><code class="inline-code tt">UpdateDrawingMat()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Update material settings before drawing</font></font></li>
<li><code class="inline-code tt">Draw(Drawable drawable)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pass </font><font style="vertical-align: inherit;">: </font></font><code class="inline-code tt">drawMat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to </font></font><code class="inline-code tt">drawable.Draw(Material mat)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and draw.</font></font></li>
</ul>
<div id="spray-projectionSpray" class="code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.14: projectionSpray.cs</font></font></p>
<pre class="list"> 1: public class ProjectionSpray : MonoBehaviour {<font></font>
 2: <font></font>
 3:     public Material drawingMat;<font></font>
 4: <font></font>
 5:     public float intensity = 1f;<font></font>
 6:     public Color color = Color.white;<font></font>
 7:     [Range(0.01f, 90f)] public float angle = 30f;<font></font>
 8:     public float range = 10f;<font></font>
 9:     public Texture cookie;<font></font>
10:     public int shadowMapResolution = 1024;<font></font>
11: <font></font>
12:     Shader depthRenderShader {<font></font>
13:         get { return Shader.Find("Unlit/depthRender"); }<font></font>
14:     }<font></font>
15: <font></font>
16:     new Camera camera{get{~~}}<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
17: Room _c;</font></font><font></font>
18:     RenderTexture depthOutput;<font></font>
19: <font></font>
20:     public void UpdateDrawingMat()<font></font>
21:     {<font></font>
22:         var currentRt = RenderTexture.active;<font></font>
23:         RenderTexture.active = depthOutput;<font></font>
24:         GL.Clear(true, true, Color.white * camera.farClipPlane);<font></font>
25:         camera.fieldOfView = angle;<font></font>
26:         camera.nearClipPlane = 0.01f;<font></font>
27:         camera.farClipPlane = range;<font></font>
28:         camera.Render();<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
29: // Update depth texture</font></font><font></font>
30:         RenderTexture.active = currentRt;<font></font>
31: <font></font>
32:         var projMatrix = camera.projectionMatrix;<font></font>
33:         var worldToDrawerMatrix = transform.worldToLocalMatrix;<font></font>
34: <font></font>
35:         drawingMat.SetVector("_DrawerPos", transform.position);<font></font>
36:         drawingMat.SetFloat("_Emission", intensity * Time.smoothDeltaTime);<font></font>
37:         drawingMat.SetColor("_Color", color);<font></font>
38:         drawingMat.SetMatrix("_WorldToDrawerMatrix", worldToDrawerMatrix);<font></font>
39:         drawingMat.SetMatrix("_ProjMatrix", projMatrix);<font></font>
40:         drawingMat.SetTexture("_Cookie", cookie);<font></font>
41:         drawingMat.SetTexture("_DrawerDepth", depthOutput);<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
42: // The property name is different, but the information passed is the same as the spotlight.</font></font><font></font>
43:     }<font></font>
44: <font></font>
45:     public void Draw(Drawable drawable)<font></font>
46:     {<font></font>
47:         drawable.Draw(drawingMat);<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
48: // The drawing process itself is done with Drawable.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
49: // Projection Spray has the Material to draw.</font></font><font></font>
50:     }<font></font>
51: }<font></font>
</pre>
</div>

<h4><a id="h4-3-2-2"></a>Drawable.cs</h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The object to be drawn by spraying. </font><font style="vertical-align: inherit;">It has a texture for drawing. </font></font><code class="inline-code tt">Start()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the function </font></font><code class="inline-code tt">RenderTexture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">creates a. </font><font style="vertical-align: inherit;">It uses the classic Ping-pong Buffer.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's see the processing of the part that draws on the texture</font></font></p>
<div id="spray-drawable" class="code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.15: Drawable.cs</font></font></p>
<pre class="list"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1: // This function is called from projectionSpray.Draw (Drawable drawable)</font></font><font></font>
 2:     public void Draw(Material drawingMat)<font></font>
 3:     {<font></font>
 4:         drawingMat.SetTexture("_MainTex", pingPongRts[0]);<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 5: // Set the current state of the texture to be drawn as the material.</font></font><font></font>
 6: <font></font>
 7:         var currentActive = RenderTexture.active;<font></font>
 8:         RenderTexture.active = pingPongRts[1];<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 9: // Set the texture to be drawn.</font></font><font></font>
10:         GL.Clear(true, true, Color.clear);<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
11: // Clear the texture to be drawn.</font></font><font></font>
12:         drawingMat.SetPass(0);<font></font>
13:         Graphics.DrawMeshNow(mesh, transform.localToWorldMatrix);<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
14: // Updated texture with target mesh and transform values ​​to draw.</font></font><font></font>
15:         RenderTexture.active = currentActive;<font></font>
16: <font></font>
17:         Swap(pingPongRts);<font></font>
18: <font></font>
19:         if(fillCrack!=null)<font></font>
20:         {<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
21: // This is a process to prevent cracks from forming at the joints of Uv.</font></font><font></font>
22:             Graphics.Blit(pingPongRts[0], pingPongRts[1], fillCrack);<font></font>
23:             Swap(pingPongRts);<font></font>
24:         }<font></font>
25: <font></font>
26:         Graphics.CopyTexture(pingPongRts[0], output);<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
27: // Copy the updated texture to output</font></font><font></font>
28:     }<font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The point here is </font><font style="vertical-align: inherit;">that we are updating </font></font><code class="inline-code tt">Graphics.DrawMeshNow(mesh, matrix)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">using </font></font><code class="inline-code tt">RenderTexture</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Since </font><font style="vertical-align: inherit;">the vertex shader of </font><font style="vertical-align: inherit;">( </font></font><span class="listref"><a href="https://freder.io/files/unity2/sugino.html#spray-drawable"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.15</font></font></a></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><font style="vertical-align: inherit;">expands </font></font><code class="inline-code tt">drawingMat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the vertices of </font></font><code class="inline-code tt">mesh.uv2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the </font><font style="vertical-align: inherit;">mesh into </font><font style="vertical-align: inherit;">the shape of, it is possible to update the texture after passing the vertex position, normal, and transform information of the mesh to the fragment shader. .. </font><font style="vertical-align: inherit;">( </font></font><span class="listref"><a href="https://freder.io/files/unity2/sugino.html#sprayProjection-shader"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.16</font></font></a></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></p>
<div id="sprayProjection-shader" class="code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 4.16: ProjectionSpray.shader</font></font></p>
<pre class="list"> 1: v2f vert (appdata v)<font></font>
 2: {<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 3: v.uv2.y = 1.0 - v.uv2.y;</font></font></font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 4: // Invert and!</font></font></font></font><font></font>
 5: <font></font>
 6:     v2f o;<font></font>
 7:     o.vertex = float4(v.uv2*2.0 - 1.0, 0.0, 1.0);<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 8: // Same process as showUv2!</font></font><font></font>
 9:     o.uv = v.uv2;<font></font>
10:     o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;<font></font>
11:     o.normal = UnityObjectToWorldNormal(v.normal);<font></font>
12:     return o;<font></font>
13: }<font></font>
14: <font></font>
15: sampler2D _MainTex;<font></font>
16: <font></font>
17: uniform float4x4 _ProjMatrix, _WorldToDrawerMatrix;<font></font>
18: <font></font>
19: sampler2D _Cookie, _DrawerDepth;<font></font>
20: half4 _DrawerPos, _Color;<font></font>
21: half _Emission;<font></font>
22: <font></font>
23: half4 frag (v2f i) : SV_Target<font></font>
24: {<font></font>
25:     ///diffuse<font></font>
26:     half3 to = i.worldPos - _DrawerPos.xyz;<font></font>
27:     half3 dir = normalize(to);<font></font>
28:     half dist = length(to);<font></font>
29:     half atten = _Emission * dot(-dir, i.normal) / (dist * dist);<font></font>
30: <font></font>
31:     ///spot cookie<font></font>
32:     half4 drawerSpacePos = mul(<font></font>
33:         _WorldToDrawerMatrix,<font></font>
34:         half4(i.worldPos, 1.0)<font></font>
35:     );<font></font>
36:     half4 projPos = mul(_ProjMatrix, drawerSpacePos);<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
37: projPos.z * = -1;</font></font><font></font>
38:     half2 drawerUv = projPos.xy / projPos.z;<font></font>
39:     drawerUv = drawerUv * 0.5 + 0.5;<font></font>
40:     half cookie = tex2D(_Cookie, drawerUv);<font></font>
41:     cookie *=<font></font>
42:         0&lt;drawerUv.x &amp;&amp; drawerUv.x&lt;1 &amp;&amp;<font></font>
43:         0&lt;drawerUv.y &amp;&amp; drawerUv.y&lt;1 &amp;&amp; 0&lt;projPos.z;<font></font>
44: <font></font>
45:     ///shadow<font></font>
46:     half drawerDepth = tex2D(_DrawerDepth, drawerUv).r;<font></font>
47:     atten *= 1.0 - saturate(10 * abs(drawerSpacePos.z) - 10 * drawerDepth);<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
48: // So far, it's the same as spotlight processing!</font></font><font></font>
49: <font></font>
50:     i.uv.y = 1 - i.uv.y;<font></font>
51:     half4 col = tex2D(_MainTex, i.uv);<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
52: // _MainTex is assigned drawable.pingPongRts [0]</font></font><font></font>
53:     col.rgb = lerp(<font></font>
54:         col.rgb,<font></font>
55:         _Color.rgb,<font></font>
56:         saturate(col.a * _Emission * atten * cookie)<font></font>
57:     );<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
58: // This is the process of drawing!</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
59: // Complementing the original texture to the drawn color according to the calculated lighting intensity.</font></font><font></font>
60: <font></font>
61:     col.a = 1;<font></font>
62:     return col;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
63: // The value is output to drawable.pingPongRts [1]</font></font><font></font>
64: }<font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can now spray the 3D model. </font><font style="vertical-align: inherit;">( </font></font><span class="imgref"><a href="https://freder.io/files/unity2/sugino.html#buddha-spray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 4.14</font></font></a></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></p>
<div id="buddha-spray" class="image">
<img src="./Chapter 4 _ Projection Spray_files/buddha-spray.png" alt="01_projectionSpray.unity">
<p class="caption">
図4.14: 01_projectionSpray.unity
</p>
</div>

<h2><a id="h4-4"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Summary</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you look at UnityCG.cginc, Lighting.cginc, etc., the built-in processing is written, and it will be a reference to implement various processing, so it is good to see it!</font></font></p><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="./Chapter 4 _ Projection Spray_files/translate_24dp.png" width="20" height="20" alt="Google Translate"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">Original text</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">Contribute a better translation</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div>


<div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div><iframe frameborder="0" class="goog-te-menu-frame skiptranslate" title="Language Translate Widget" style="visibility: visible; box-sizing: content-box; width: 1001px; height: 263px; display: none;" src="./Chapter 4 _ Projection Spray_files/saved_resource(1).html"></iframe><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="https://www.gstatic.com/images/branding/product/1x/translate_24dp.png" width="20" height="20" alt="Google Translate"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">Original text</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">Contribute a better translation</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div><iframe frameborder="0" class="goog-te-menu-frame skiptranslate" title="Language Translate Widget" style="visibility: visible; box-sizing: content-box; width: 197px; height: 69px; display: none;" src="./Chapter 4 _ Projection Spray_files/saved_resource(2).html"></iframe><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="https://www.gstatic.com/images/branding/product/1x/translate_24dp.png" width="20" height="20" alt="Google Translate"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">Original text</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">Contribute a better translation</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div><div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="https://www.gstatic.com/images/branding/product/1x/translate_24dp.png" width="20" height="20" alt="Google Translate"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">Original text</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">Contribute a better translation</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div><div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div><div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div><iframe frameborder="0" class="goog-te-menu-frame skiptranslate" title="Language Translate Widget" style="visibility: visible; box-sizing: content-box; width: 1001px; height: 263px; display: none;"></iframe><iframe frameborder="0" class="goog-te-menu-frame skiptranslate" title="Language Translate Widget" style="visibility: visible; box-sizing: content-box; width: 197px; height: 69px; display: none;"></iframe><iframe frameborder="0" class="goog-te-menu-frame skiptranslate" title="Language Translate Widget" style="visibility: visible; box-sizing: content-box; width: 1001px; height: 263px; display: none;"></iframe><iframe frameborder="0" class="goog-te-menu-frame skiptranslate" title="Language Translate Widget" style="visibility: visible; box-sizing: content-box; width: 197px; height: 69px; display: none;"></iframe></body></html>