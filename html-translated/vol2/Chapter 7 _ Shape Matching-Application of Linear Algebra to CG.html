<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:ops="http://www.idpf.org/2007/ops" xml:lang="en" class="translated-ltr" style="height: 100%;"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <link rel="stylesheet" type="text/css" href="./Chapter 7 _ Shape Matching-Application of Linear Algebra to CG_files/style.scss">
  <meta name="generator" content="Re:VIEW">
  <title>Shape Matching-Application of Linear Algebra to CG</title>

			<style>
				img {
					max-width: 80vw;
					max-height: 80vh;
				}
			</style><style>
					.goog-te-banner-frame {
						display: none;
					}
				</style>
			<script>(function(){(function injection() {
  var pageLang = 'ja';
  var userLang = 'en';

  var uid = '1E07F158C6FA4460B352973E9693B329';
  var teId = 'TE_' + uid;
  var cbId = 'TECB_' + uid;

  function show() {
    window.setTimeout(function() {
      window[teId].showBanner(true);
    }, 10);
  }

  function newElem() {
    
  }

  if (window[teId]) {
    show();
  } else {
    if (!window.google || !google.translate ||
        !google.translate.TranslateElement) {
      if (!window[cbId]) {
        window[cbId] = function() {
          window[teId] = newElem();
          show();
        };
      }
      
    }
  }
})();})();</script><script src="https://translate.google.com/translate_a/element.js?cb=TECB_1E07F158C6FA4460B352973E9693B329&amp;client=tee&amp;hl=en"></script><script src="./Chapter 7 _ Shape Matching-Application of Linear Algebra to CG_files/f.txt"></script><link type="text/css" rel="stylesheet" charset="UTF-8" href="https://translate.googleapis.com/translate_static/css/translateelement.css"><script type="text/javascript" charset="UTF-8" src="https://translate.googleapis.com/translate_static/js/element/main.js"></script><link type="text/css" rel="stylesheet" charset="UTF-8" href="./Chapter 7 _ Shape Matching-Application of Linear Algebra to CG_files/translateelement.css"><script type="text/javascript" charset="UTF-8" src="./Chapter 7 _ Shape Matching-Application of Linear Algebra to CG_files/main.js"></script><script type="text/javascript" charset="UTF-8" src="https://translate.googleapis.com/element/TE_20201130_00/e/js/element/element_main.js"></script><script type="text/javascript" charset="UTF-8" src="./Chapter 7 _ Shape Matching-Application of Linear Algebra to CG_files/element_main.js"></script><script type="text/javascript" charset="UTF-8" src="https://translate.googleapis.com/element/TE_20201130_00/e/js/element/element_main.js"></script><link type="text/css" rel="stylesheet" charset="UTF-8" href="https://translate.googleapis.com/translate_static/css/translateelement.css"><script type="text/javascript" charset="UTF-8" src="https://translate.googleapis.com/translate_static/js/element/main.js"></script><script type="text/javascript" charset="UTF-8" src="https://translate.googleapis.com/element/TE_20201130_00/e/js/element/element_main.js"></script></head>
		
<body style="position: relative; min-height: 100%; top: 40px;"><div class="skiptranslate" style=""><iframe id=":0.container" class="goog-te-banner-frame skiptranslate" frameborder="0" src="javascript:''" style="visibility:visible"></iframe></div><div class="skiptranslate" style=""><iframe id=":0.container" class="goog-te-banner-frame skiptranslate" frameborder="0" src="javascript:''" style="visibility:visible"></iframe></div><div class="skiptranslate" style=""><iframe id=":0.container" class="goog-te-banner-frame skiptranslate" frameborder="0" src="javascript:''" style="visibility:visible"></iframe></div>
<h1><a id="h7"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chapter 7　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Shape Matching-Application of Linear Algebra to CG</font></font></h1>

<h2><a id="h7-1"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.1　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Introduction</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this chapter, we will introduce learning of singular value decomposition and applications using singular value decomposition from the basics and applications of linear algebra. Although I learned linear algebra in high school students and university students, I think that there are many people who do not know how it is used, so I wrote this time. In this chapter, in order to prioritize ease of understanding </font><font style="vertical-align: inherit;">, explanations </font><font style="vertical-align: inherit;">are given in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">two dimensions and within the range of real numbers.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Therefore, there are some differences from the actual definition of linear algebra, but we would appreciate it if you could read it as appropriate.</font></font></p>

<h2><a id="h7-2"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.2　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What is a matrix?</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Most readers may have heard the word matrix once (currently, they don't learn matrices in high school ...). Matrix is ​​a number like this: Refers to those arranged vertically and horizontally.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The horizontal direction is the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">row</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the vertical direction is the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">column</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the diagonal direction is the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diagonal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and each number </font><font style="vertical-align: inherit;">is called a </font><font style="vertical-align: inherit;">matrix </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">element</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></p>
<div id="matrix" class="image">
<img src="./Chapter 7 _ Shape Matching-Application of Linear Algebra to CG_files/matrix.png" alt="Ranks" class="width-020per">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figure 7.1: Matrix
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By the way, the matrix is ​​called Matrix in English.</font></font></p>

<h2><a id="h7-3"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.3　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Review of matrix operations</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's take a quick look at the basics of matrix operations. If you are already familiar with it, you can skip this section.</font></font></p>

<h3><a id="h7-3-1"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.3.1 Addition,　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> subtraction, multiplication and division</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Similar to the four arithmetic operations of scalars, there are additions, subtractions, multiplications and divisions in matrices. For simplicity, quadratic square matrices </font></font><a id="fnb-square" href="https://freder.io/files/unity2/takao.html#fn-square" class="noteref" epub:type="noteref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 1 </font></font></a><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ A $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ B $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , The 2D vector </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ c $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is defined below.</font></font></p>
<div class="footnote" epub:type="footnote" id="fn-square"><p class="footnote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[* 1] Square matrix </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ cdots A</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> matrix </font><font style="vertical-align: inherit;">with the same number of rows and columns.</font></font></p></div>

<h4><a id="h7-3-1-1"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Addition</font></font></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Matrix addition calculates the sum for each element, as in the formula (\ ref {plus}).</font></font></p>

<h4><a id="h7-3-1-2"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Subtraction</font></font></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Matrix subtraction calculates the difference element by element, as in the formula (\ ref {minus}).</font></font></p>

<h4><a id="h7-3-1-3"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Multiply</font></font></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Matrix multiplication is a bit more complicated, like an expression (\ ref {times}).</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Please note that if you reverse the order of multiplication, the calculation result will also change.</font></font></p>

<h4><a id="h7-3-1-4"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Divide (reverse column)</font></font></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Matrix division uses </font><font style="vertical-align: inherit;">a concept called </font><font style="vertical-align: inherit;">the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inverse matrix</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which is a </font><font style="vertical-align: inherit;">little different from division in scalars </font><font style="vertical-align: inherit;">. First of all, scalars have the property that when multiplied by their own reciprocal, they always become 1.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In other words, the act of division is equivalent to the operation of "multiplying the reciprocal".</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Replacing this with a matrix, we can say that what produces the identity matrix over the matrix is ​​the matrix that represents division. In the matrix, the </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> corresponding to </font><span class="equation"><font style="vertical-align: inherit;">1</font></span><font style="vertical-align: inherit;"> in the scalar </font><font style="vertical-align: inherit;">is called the identity matrix and is defined below. ..</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As with the scalar </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the value does not change when the identity matrix is ​​applied to any matrix.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With these in mind, </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">let's</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> consider matrix division. If the inverse matrix is </font><span class="equation"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ M $} ^ {-1}</font></span><font style="vertical-align: inherit;"> , the definition of the inverse matrix is ​​as follows.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Derivation is omitted, but </font><font style="vertical-align: inherit;">the elements of the inverse matrix of </font><font style="vertical-align: inherit;">the matrix </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ A $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are defined below.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At this time, </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a_ {00} a_ {11} --a_ {01} a_ {10}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is called a determinant (Determinant) and </font><font style="vertical-align: inherit;">is expressed as </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">det (\ mbox {\ boldmath $ A $})</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></p>

<h3><a id="h7-3-2"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.3.2　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Matrix action on vector</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A matrix can transform the coordinates pointed to by a vector by multiplying it by a vector. As you know, in CG, it is mostly used as a coordinate transformation matrix (world, projection, view transformation matrix). The product of and the vector is defined below.</font></font></p>

<h2><a id="h7-4"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Application of matrix operation</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From this section, I will explain the concept of the matrix in the range learned at the university. I think that there are many parts that seem a little difficult, but to understand Shape Matching, this concept is necessary, so do your best. However, since the story in this section is also absorbed inside the matrix operation library, there is no problem in implementing it even if you skip to section \ ref {shape matching}.</font></font></p>

<h3><a id="h7-4-1"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.1　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Transpose matrix</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The transposed matrix is ​​the swapped rows and columns of the elements and is defined below.</font></font></p>

<h3><a id="h7-4-2"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.2　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Symmetric matrix</font></font></h3>
<p><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> matrix that satisfies </font><span class="equation"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ A $} ^ {T} = \ mbox {\ boldmath $ A $}</font></span><font style="vertical-align: inherit;"> is called a symmetric matrix.</font></font></p>

<h3><a id="h7-4-3"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.3　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eigenvalues ​​and eigenvectors</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Given the square matrix </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ A $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meet the </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ lambda</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a, </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ Mbox {\ Boldmath $ A $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> of </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eigenvalues</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ Mbox {\ Boldmath $ V $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eigenvectors</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is called.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The calculation method of eigenvalues ​​and eigenvectors is shown below. First, the formula (\ ref {eigen}) is transformed.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here, </font><font style="vertical-align: inherit;">using the condition </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ v $} \ neq 0</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the expression (\ ref {eigen2}) becomes:</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Becomes. Expanding this expression, </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ lambda</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to become a quadratic equation for, by solving this </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ lambda</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> can be calculated. Moreover, each of the calculated </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ lambda</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> expressions (\ ref { By substituting into eigen2}), </font><font style="vertical-align: inherit;">you can calculate the </font><font style="vertical-align: inherit;">eigenvector </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ v $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since the concept of eigenvalues ​​and eigenvectors is difficult to understand from mathematical formulas alone, I think you should also read the Qiita article (described at the end of the chapter) where eigenvalues ​​were visualized by @ kenmatsu4.</font></font></p>

<h3><a id="h7-4-4"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.4　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eigenvalue decomposition</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The eigenvalues ​​and eigenvectors in the </font><font style="vertical-align: inherit;">square matrix </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ A $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> can be used to represent the matrix </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ A $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in different ways. First, the eigenvalues </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ lambda</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are sorted by size </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">Create </font><font style="vertical-align: inherit;">a matrix </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ \ Lambda $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with </font><font style="vertical-align: inherit;">it as a diagonal element </font><font style="vertical-align: inherit;">. Next, a matrix </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ V $} in</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> which the eigenvectors corresponding to each eigenvalue are arranged in order from the left </font><span class="equation"><font style="vertical-align: inherit;">.</font></span><font style="vertical-align: inherit;"> Then, the expression ( </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ ref {eigen}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) can be rewritten using these matrices as follows.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Furthermore, </font><font style="vertical-align: inherit;">multiply this by </font><span class="equation"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ V $} ^ {-1}</font></span><font style="vertical-align: inherit;"> from the right of both sides so </font><font style="vertical-align: inherit;">that the matrix </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ A $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> remains </font><font style="vertical-align: inherit;">on the left side </font><font style="vertical-align: inherit;">.</font></font><span class="equation"><font style="vertical-align: inherit;"></font></span><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Will be.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decomposing a matrix into a form like an expression (\ ref {eigendecomp}) in this way is called eigenvalue decomposition of a matrix.</font></font></p>

<h3><a id="h7-4-5"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.5　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Orthonormal Basis</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A set of vectors that are perpendicular to each other and each is a unit vector is called an orthonormal basis. Any vector can be represented using a set of orthonormal bases </font></font><a id="fnb-ichi" href="https://freder.io/files/unity2/takao.html#fn-ichi" class="noteref" epub:type="noteref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2. In the case of two dimensions, There are two vectors that can be orthonormal bases. For example, the commonly used x-axis and y-axis are </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ x $} = (1, 0), \ mbox {\ boldmath $ y $} = Since the set of (0, 1)</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> forms an orthonormal basis, any vector </font><font style="vertical-align: inherit;">can be represented </font><font style="vertical-align: inherit;">by this </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ x $}, \ mbox {\ boldmath $ y $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ Expressing mbox {\ boldmath $ v $} = (4, 13)</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> using orthonormal basis </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ x $}, \ mbox {\ boldmath $ y $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ v $} = 4 \ mbox {\ boldmath $ x $} + 13 \ mbox {\ boldmath $ y $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></p>
<div class="footnote" epub:type="footnote" id="fn-ichi"><p class="footnote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[* 2] Formally, it is called a linear combination of vectors.</font></font></p></div>

<h3><a id="h7-4-6"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.6　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hermitian matrix</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Hermitian matrix is ​​defined in the range of complex numbers, which is beyond the scope of this chapter, so I will briefly explain it in the range of real numbers. In the range of real numbers, </font><font style="vertical-align: inherit;">the Hermitian </font><font style="vertical-align: inherit;">of the matrix </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ A $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The matrix </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ A $} ^ {*}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> simply means that it is a symmetric matrix.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Will be.</font></font></p>

<h3><a id="h7-4-7"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.7　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Orthogonal matrix</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Square matrix </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ Q $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> column vector </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q = (\ mbox {\ boldmath $ q $} _1, \ mbox {\ boldmath $ q $} _2, \ cdots, \ mbox {\ boldmath $ q $</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> When decomposed into </font><span class="equation"><font style="vertical-align: inherit;">} _n)</font></span><font style="vertical-align: inherit;"> , the set of these vectors forms an orthonormal system, that is,</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When is true, </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ Q $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is said to be an orthogonal matrix. Also, even if the orthogonal matrix is ​​decomposed into row vectors, it has the characteristic of </font><span class="equation"><font style="vertical-align: inherit;">forming an</font></span><font style="vertical-align: inherit;"> orthonormal system.</font></font></p>

<h3><a id="h7-4-8"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4.8　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Unitary matrix</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A matrix that satisfies is called a unitary matrix. If </font><font style="vertical-align: inherit;">all the elements of the </font><font style="vertical-align: inherit;">unitary matrix </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ U $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are real ( </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">execution</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> columns), </font><span class="equation"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ U $} ^ {*} = \ mbox Since</font></span><font style="vertical-align: inherit;"> it becomes </font><span class="equation"><font style="vertical-align: inherit;">{\ boldmath $ U $} ^ {T}</font></span><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">we can see that </font><font style="vertical-align: inherit;">the real unitary matrix </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ U $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is an orthogonal matrix.</font></font></p>

<h2><a id="h7-5"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.5　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Singular value decomposition</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Decomposing an </font><font style="vertical-align: inherit;">arbitrary </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m \ times n</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> matrix </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ A $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> into the following form is called singular value decomposition of the matrix.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note that </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ U $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ V $} ^ {T}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are </font><font style="vertical-align: inherit;">orthogonal matrices of </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m \ times m</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ \ Sigma $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m \ times. It is</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a diagonal matrix of </font><span class="equation"><font style="vertical-align: inherit;">n</font></span><font style="vertical-align: inherit;"> (diagonal elements are non-negative and arranged in order of magnitude).</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The word "arbitrary" is important, and the eigenvalue decomposition of a matrix is ​​defined only for a square matrix, but the singular value decomposition can also be performed for a square matrix. In the CG world, the matrix to be handled is a square matrix. In most cases, the calculation method is not so different from the eigenvalue decomposition. Also, when </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ A $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is a symmetric matrix, </font><font style="vertical-align: inherit;">the eigenvalues ​​and singular values ​​of </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ A $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> matches. in addition, </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ a $ } </font><font style="vertical-align: inherit;">^ {T} \ mbox {\ boldmath $ a $</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> } of </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is a positive eigenvalues is not the square root of </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ a $</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> } of singular value is.</font></font></p>

<h3><a id="h7-5-1"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.5.1　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Singular value decomposition algorithm</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The dropped eigenvalue decomposition to program the formula is helpful to the (\ ref {svd}) Formula deformed. Matrices </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ A $</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> } transpose of the left from the matrix of </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ A $</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> } Multiply by </font><span class="equation"><font style="vertical-align: inherit;">^ {T}</font></span><font style="vertical-align: inherit;"> to get:</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You will notice that the form is the same as the eigenvalue decomposition. In fact, it is known that the square of the singular value matrix becomes the eigenvalue matrix. Therefore, the calculation of the singular value decomposes the matrix into eigenvalues. This can be done by taking the square root of the eigenvalues. This leads to the incorporation of eigenvalue decomposition into the algorithm, but fortunately it is necessary to solve a quadratic equation to find the eigenvalues. Since the solution formula of the quadratic equation is simple, it is easy to drop it into the program </font></font><a id="fnb-kai" href="https://freder.io/files/unity2/takao.html#fn-kai" class="noteref" epub:type="noteref"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></p>
<div class="footnote" epub:type="footnote" id="fn-kai"><p class="footnote"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[* 3] Although there are solution formulas for cubic and quartic equations, they are generally calculated using Newton's method. </font></font></p></div>
<p><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ A $} ^ {T} \ mbox {\ boldmath $ A $} By</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eigenvalue decomposition, </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ \ Sigma $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ V $} ^ {</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Now that </font><span class="equation"><font style="vertical-align: inherit;">T}</font></span><font style="vertical-align: inherit;"> has been calculated, the remaining </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ U $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> can be calculated by transforming the formula (\ ref {svd}) as follows.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since V is an orthogonal matrix, the transpose and the inverse matrix match.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This can be expressed programmatically as follows.</font></font></p>
<div id="render" class="code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 7.1: Singular Value Decomposition Algorithm (Matrix2x2.cs)</font></font></p>
<pre class="list language-csharp"> 1: /// &lt;summary&gt;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 2: /// Singular value decomposition</font></font><font></font>
 3: /// &lt;/summary&gt;<font></font>
 4: /// &lt;param name="u"&gt;Returns rotation matrix u&lt;/param&gt;<font></font>
 5: /// &lt;param name="s"&gt;Returns sigma matrix&lt;/param&gt;<font></font>
 6: /// &lt;param name="v"&gt;Returns rotation matrix v(not transposed)&lt;/param&gt;<font></font>
 7: public void SVD(ref Matrix2x2 u, ref Matrix2x2 s, ref Matrix2x2 v)<font></font>
 8: {<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 9: // If it was a diagonal matrix, the singular value decomposition is simply given below.</font></font><font></font>
10:     if (Mathf.Abs(this[1, 0] - this[0, 1]) &lt; MATRIX_EPSILON<font></font>
11:         &amp;&amp; Mathf.Abs(this[1, 0]) &lt; MATRIX_EPSILON)<font></font>
12:     {<font></font>
13:         u.SetValue(this[0, 0] &lt; 0 ? -1 : 1, 0,<font></font>
14:                     0, this[1, 1] &lt; 0 ? -1 : 1);<font></font>
15:         s.SetValue(Mathf.Abs(this[0, 0]), Mathf.Abs(this[1, 1]));<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
16: v.LoadIdentity ();</font></font></font></font><font></font>
17:     }<font></font>
18: <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
19: // Calculate A ^ T * A if it is not a diagonal matrix.</font></font><font></font>
20:     else<font></font>
21:     {<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
22: // 0 Column vector length (non-root)</font></font><font></font>
23:         float i   = this[0, 0] * this[0, 0] + this[1, 0] * this[1, 0];<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
24: // Length of 1 column vector (non-root)</font></font><font></font>
25:         float j   = this[0, 1] * this[0, 1] + this[1, 1] * this[1, 1];<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
26: // Inner product of column vectors</font></font><font></font>
27:         float i_dot_j = this[0, 0] * this[0, 1]<font></font>
28:                           + this[1, 0] * this[1, 1];<font></font>
29: <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
30: // If A ^ T * A is an orthogonal matrix</font></font><font></font>
31:         if (Mathf.Abs(i_dot_j) &lt; MATRIX_EPSILON)<font></font>
32:         {<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
33: // Calculation of diagonal elements of the singular value matrix</font></font><font></font>
34:             float s1 = Mathf.Sqrt(i);<font></font>
35:             float s2 = Mathf.Abs(i - j) &lt;<font></font>
36:                         MATRIX_EPSILON ? s1 : Mathf.Sqrt(j);<font></font>
37: <font></font>
38:             u.SetValue(this[0, 0] / s1, this[0, 1] / s2,<font></font>
39:                         this[1, 0] / s1, this[1, 1] / s2);<font></font>
40:             s.SetValue(s1, s2);<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
41: v.LoadIdentity ();</font></font></font></font><font></font>
42:         }<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
43: // If A ^ T * A is not an orthogonal matrix, solve the quadratic equation to find the eigenvalues.</font></font><font></font>
44:         else<font></font>
45:         {<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
46: // Calculation of eigenvalues ​​/ eigenvectors</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
47: float i_minus_j = i --j; // Difference in column vector length</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
48: float i_plus_j = i + j; // sum of column vector lengths</font></font><font></font>
49: <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
50: // Formula for solving quadratic equations</font></font><font></font>
51:             float root = Mathf.Sqrt(i_minus_j * i_minus_j<font></font>
52:                                       + 4 * i_dot_j * i_dot_j);<font></font>
53:             float eig = (i_plus_j + root) * 0.5f;<font></font>
54:             float s1 = Mathf.Sqrt(eig);<font></font>
55:             float s2 = Mathf.Abs(root) &lt;<font></font>
56:                         MATRIX_EPSILON ? s1 :<font></font>
57:                           Mathf.Sqrt((i_plus_j - root) / 2);<font></font>
58: <font></font>
59:             s.SetValue(s1, s2);<font></font>
60: <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
61: // Use the eigenvector of A ^ T * A as V.</font></font><font></font>
62:             float v_s = eig - i;<font></font>
63:             float len = Mathf.Sqrt(v_s * v_s + i_dot_j * i_dot_j);<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
64: i_dot_j / = len;</font></font></font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
65: v_s / = only;</font></font><font></font>
66:             v.SetValue(i_dot_j, -v_s, v_s, i_dot_j);<font></font>
67: <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
68: // Since v and s have already been calculated, the rotation matrix u is calculated by Av / s.</font></font><font></font>
69:             u.SetValue(<font></font>
70:                 (this[0, 0] * i_dot_j + this[0, 1] * v_s) / s1,<font></font>
71:                 (this[0, 1] * i_dot_j - this[0, 0] * v_s) / s2,<font></font>
72:                 (this[1, 0] * i_dot_j + this[1, 1] * v_s) / s1,<font></font>
73:                 (this[1, 1] * i_dot_j - this[1, 0] * v_s) / s2<font></font>
74:             );<font></font>
75:         }<font></font>
76:     }<font></font>
77: }<font></font>
</pre>
</div>

<h2><a id="h7-6"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Algorithm using singular value decomposition</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Singular value decomposition is active in a wide variety of fields, and seems to be used mainly in principal component analysis (PCA) in statistics. There are many cases where it is used in CG.</font></font></p>
<ul>
<li>Shape Matching<a id="fnb-sm" href="https://freder.io/files/unity2/takao.html#fn-sm" class="noteref" epub:type="noteref">*4</a></li>
<li>Anisotropic Kernel<a id="fnb-ak" href="https://freder.io/files/unity2/takao.html#fn-ak" class="noteref" epub:type="noteref">*5</a></li>
<li>Material Point Method<a id="fnb-mpm" href="https://freder.io/files/unity2/takao.html#fn-mpm" class="noteref" epub:type="noteref">*6</a></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And so on.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This time, we will focus on Shape Matching and explain the basic idea.</font></font></p>
<div class="footnote" epub:type="footnote" id="fn-sm"><p class="footnote">[*4] Meshless deformations based on shape matching, Matthias Muller et al., SIGGRAPH 2005 </p></div>
<div class="footnote" epub:type="footnote" id="fn-ak"><p class="footnote">[*5] Reconstructing surfaces of particle-based fluids using anisotropic kernels, Jihun Yu et al., ACM Transaction on Graphics 2013</p></div>
<div class="footnote" epub:type="footnote" id="fn-mpm"><p class="footnote">[*6] A material point method for snow simulation, Alexey Stomakhin et al., SIGGRAPH 2013</p></div>

<h2><a id="h7-7"></a><span class="secno">7.7　</span>Shape Matching</h2>
<p>\label{shapematching}</p>

<h3><a id="h7-7-1"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.7.1　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Overview</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shape Matching is a technique for aligning two different shapes within the range where there is as little error as possible. Currently, a method for simulating an elastic body using Shape Matching is being developed. ..</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This section </font><font style="vertical-align: inherit;">describes the algorithm for aligning the unicorn object placement to the lion object placement </font><font style="vertical-align: inherit;">, as </font><span class="imgref"><a href="https://freder.io/files/unity2/takao.html#result"><font style="vertical-align: inherit;">shown</font></a></span><font style="vertical-align: inherit;"> in </font></font><span class="imgref"><a href="https://freder.io/files/unity2/takao.html#aim"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 7.2</font></font></a></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><span class="imgref"><a href="https://freder.io/files/unity2/takao.html#result"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 7.3</font></font></a></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></p>
<div id="aim" class="image">
<img src="./Chapter 7 _ Shape Matching-Application of Linear Algebra to CG_files/aim.png" alt="Two objects">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figure 7.2: Two objects
</font></font></p>
</div>
<div id="result" class="image">
<img src="./Chapter 7 _ Shape Matching-Application of Linear Algebra to CG_files/result.png" alt="Aligned result" class="width-055per">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figure 7.3: Aligned results
</font></font></p>
</div>

<h3><a id="h7-7-2"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.7.2　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Algorithm</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First, define a set of the same number of points on each shape. (Lion's point set is P, Unicorn's point set is Q.)</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At this time, </font><font style="vertical-align: inherit;">note that </font><font style="vertical-align: inherit;">those with the same subscript are </font><font style="vertical-align: inherit;">in the geometrically corresponding positions as </font></font><span class="imgref"><a href="https://freder.io/files/unity2/takao.html#point"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shown in Fig. 7.4</font></font></a></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></p>
<div id="point" class="image">
<img src="./Chapter 7 _ Shape Matching-Application of Linear Algebra to CG_files/point.png" alt="Correspondence of point set">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figure 7.4: Correspondence of point sets
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next, calculate the centroid of each point set.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assuming that the center of gravity of the unicorn point set is at the same position as the center of gravity of the lion point set, the rotation matrix </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ R $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is </font><span class="equation"><font style="vertical-align: inherit;">applied</font></span><font style="vertical-align: inherit;"> to the unicorn point set, </font><font style="vertical-align: inherit;">and the vector </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ t Since</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> the result of the </font><span class="equation"><font style="vertical-align: inherit;">$}</font></span><font style="vertical-align: inherit;"> translation is equal to the center of gravity of the lion, the following equation can be derived.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When this is transformed,</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And further deformed,</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Will be.</font></font></font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Therefore, from this equation, if the rotation matrix </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ R $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is obtained, the translation vector </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ t $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is </font><font style="vertical-align: inherit;">automatically </font><font style="vertical-align: inherit;">obtained. Here, the original point Define a set of points from the position of, minus the center of gravity of each.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This makes it possible to perform calculations with local coordinates with the center of gravity of each point set as the origin.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next, </font><font style="vertical-align: inherit;">the variance-covariance matrix </font><span class="equation"><font style="vertical-align: inherit;">\ mbox {\ boldmath of </font></span></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ p $} _ {i} ^ {\ prime}, \ mbox {\ boldmath $ q $} _ {i} ^ {\ prime}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Calculate </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ H $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This variance-covariance matrix </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ H $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> stores information such as the variability of the two point sets. Here the product of the vectors </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ q $} _ {i } ^ {\ prime} {\ mbox {\ boldmath $ p $} _ {i} ^ {\ prime}} ^ {T}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is an operation called direct product (outer product), unlike the normal vector internal product operation. The direct product of the vectors produces a matrix. The direct product of the two-dimensional vectors is defined below.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition, the covariance matrix </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ H $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is singularly decomposed.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the result of singular value decomposition, </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ \ sum $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is a matrix representing expansion and contraction, so the desired rotation matrix </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ R $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(The detailed derivation method is a little advanced, so I will omit it here.)</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finally, the translation vector </font></font><span class="equation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ mbox {\ boldmath $ t $}</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> can be calculated </font><font style="vertical-align: inherit;">from the obtained rotation matrix and equation (\ ref {trans}) </font><font style="vertical-align: inherit;">.</font></font></p>

<h3><a id="h7-7-3"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.7.3　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Implementation</font></font></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this implementation, the algorithm in the previous section is just dropped into the code, so detailed explanation is omitted. In addition, all the processing is completed in the Start function in ShapeMaching.cs.</font></font></p>
<div id="shapematching_impl" class="code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listing 7.2: ShapeMatching (ShapeMaching.cs)</font></font></p>
<pre class="list language-csharp"> 1: // Set p, q<font></font>
 2: p = new Vector2[n];<font></font>
 3: q = new Vector2[n];<font></font>
 4: centerP = Vector2.zero;<font></font>
 5: centerQ = Vector2.zero;<font></font>
 6: <font></font>
 7: for(int i = 0; i &lt; n; i++)<font></font>
 8: {<font></font>
 9:     Vector2 pos = _destination.transform.GetChild(i).position;<font></font>
10:     p[i] = pos;<font></font>
11:     centerP += pos;<font></font>
12: <font></font>
13:     pos = _target.transform.GetChild(i).position;<font></font>
14:     q[i] = pos;<font></font>
15:     centerQ += pos;<font></font>
16: }<font></font>
17: centerP /= n;<font></font>
18: centerQ /= n;<font></font>
19: <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
20: // Calc, p, q!</font></font><font></font>
21: Matrix2x2 H = new Matrix2x2(0, 0, 0, 0);<font></font>
22: for (int i = 0; i &lt; n; i++)<font></font>
23: {<font></font>
24:     p[i] = p[i] - centerP;<font></font>
25:     q[i] = q[i] - centerQ;<font></font>
26: <font></font>
27:     H += Matrix2x2.OuterProduct(q[i], p[i]);<font></font>
28: }<font></font>
29: <font></font>
30: Matrix2x2 u = new Matrix2x2();<font></font>
31: Matrix2x2 s = new Matrix2x2();<font></font>
32: Matrix2x2 v = new Matrix2x2();<font></font>
33: H.SVD(ref u, ref s, ref v);<font></font>
34: <font></font>
35: R = v * u.Transpose();<font></font>
36: Debug.Log(Mathf.Rad2Deg * Mathf.Acos(R.m00));<font></font>
37: t = centerP - R * centerQ;<font></font>
</pre>
</div>

<h2><a id="h7-8"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.8　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Results</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I was able to safely align the shape of the unicorn with the shape of the lion.</font></font></p>
<div id="before" class="image">
<img src="./Chapter 7 _ Shape Matching-Application of Linear Algebra to CG_files/before.png" alt="Before execution" class="width-080per">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figure 7.5: Before execution
</font></font></p>
</div>
<div id="res" class="image">
<img src="./Chapter 7 _ Shape Matching-Application of Linear Algebra to CG_files/res.png" alt="After execution" class="width-080per">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figure 7.6: After execution
</font></font></p>
</div>

<h2><a id="h7-9"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.9　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Summary</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this section, we explained the implementation of the Shape Matching method using singular value decomposition. This time, it was implemented in 2D, but it can also be implemented in 3D with the same algorithm. I think that there were many, but I hope that you will take this opportunity to become interested in the application method of matrix arithmetic in the CG field and deepen your learning.</font></font></p>

<h2><a id="h7-10"></a><span class="secno">7.10　</span>References</h2>
<ul>
<li>3D Geometry for Computer Graphics (<a href="https://igl.ethz.ch/teaching/tau/cg/cg2005/svd.ppt" class="link">https://igl.ethz.ch/teaching/tau/cg/cg2005/svd.ppt</a>)</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mathematical linear algebra of science and engineering (by Toshitaka Nagai, Atsushi Nagai) Shokabo</font></font></li>
<li>Singular Value Decomposition (the SVD) : MIT OpenCourseWare (<a href="https://www.youtube.com/watch?v=mBcLRGuAFUk" class="link">https://www.youtube.com/watch?v=mBcLRGuAFUk</a>)</li>
<li>Lecture: The Singular Value Decomposition (SVD) : AMATH 301 (<a href="https://www.youtube.com/watch?v=EokL7E6o1AE" class="link">https://www.youtube.com/watch?v=EokL7E6o1AE</a>)</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Visualize what eigenvalues ​​and eigenvectors are @ kenmatsu4 ( </font></font><a href="https://qiita.com/kenmatsu4/items/2a8573e3c878fc2da306" class="link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://qiita.com/kenmatsu4/items/2a8573e3c878fc2da306</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></li>
</ul></body></html>