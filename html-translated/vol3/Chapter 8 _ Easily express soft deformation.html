<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:ops="http://www.idpf.org/2007/ops" xml:lang="en" class="translated-ltr" style="height: 100%;"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <link rel="stylesheet" type="text/css" href="./Chapter 8 _ Easily express soft deformation_files/style.scss">
  <meta name="generator" content="Re:VIEW">
  <title>Easily express soft deformation</title>

			<style>
				img {
					max-width: 80vw;
					max-height: 80vh;
				}
			</style><style>
					.goog-te-banner-frame {
						display: none;
					}
				</style>
			<script>(function(){(function injection() {
  var pageLang = 'ja';
  var userLang = 'en';

  var uid = '1E07F158C6FA4460B352973E9693B329';
  var teId = 'TE_' + uid;
  var cbId = 'TECB_' + uid;

  function show() {
    window.setTimeout(function() {
      window[teId].showBanner(true);
    }, 10);
  }

  function newElem() {
    
  }

  if (window[teId]) {
    show();
  } else {
    if (!window.google || !google.translate ||
        !google.translate.TranslateElement) {
      if (!window[cbId]) {
        window[cbId] = function() {
          window[teId] = newElem();
          show();
        };
      }
      
    }
  }
})();})();</script><script src="https://translate.google.com/translate_a/element.js?cb=TECB_1E07F158C6FA4460B352973E9693B329&amp;client=tee&amp;hl=en"></script><script src="./Chapter 8 _ Easily express soft deformation_files/f.txt"></script><link type="text/css" rel="stylesheet" charset="UTF-8" href="https://translate.googleapis.com/translate_static/css/translateelement.css"><script type="text/javascript" charset="UTF-8" src="https://translate.googleapis.com/translate_static/js/element/main.js"></script><link type="text/css" rel="stylesheet" charset="UTF-8" href="./Chapter 8 _ Easily express soft deformation_files/translateelement.css"><script type="text/javascript" charset="UTF-8" src="./Chapter 8 _ Easily express soft deformation_files/main.js"></script><script type="text/javascript" charset="UTF-8" src="https://translate.googleapis.com/element/TE_20201130_00/e/js/element/element_main.js"></script><script type="text/javascript" charset="UTF-8" src="./Chapter 8 _ Easily express soft deformation_files/element_main.js"></script><script type="text/javascript" charset="UTF-8" src="https://translate.googleapis.com/element/TE_20201130_00/e/js/element/element_main.js"></script><link type="text/css" rel="stylesheet" charset="UTF-8" href="https://translate.googleapis.com/translate_static/css/translateelement.css"><script type="text/javascript" charset="UTF-8" src="https://translate.googleapis.com/translate_static/js/element/main.js"></script><script type="text/javascript" charset="UTF-8" src="https://translate.googleapis.com/element/TE_20201130_00/e/js/element/element_main.js"></script></head>
		
<body style="position: relative; min-height: 100%; top: 40px;"><div class="skiptranslate" style=""><iframe id=":0.container" class="goog-te-banner-frame skiptranslate" frameborder="0" src="javascript:''" style="visibility:visible"></iframe></div><div class="skiptranslate" style=""><iframe id=":0.container" class="goog-te-banner-frame skiptranslate" frameborder="0" src="javascript:''" style="visibility:visible"></iframe></div><div class="skiptranslate" style=""><iframe id=":0.container" class="goog-te-banner-frame skiptranslate" frameborder="0" src="javascript:''" style="visibility:visible"></iframe></div>
<h1><a id="h8"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chapter 8　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Easily express soft deformation</font></font></h1>
<div id="id_xjine_2F01" class="image">
<img src="./Chapter 8 _ Easily express soft deformation_files/01.png" alt="How the sphere deforms">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Figure 8.1: Sphere deforms
</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When expressing the softness of an object, we sometimes imitate a spring or calculate a simulation of a fluid or soft body, but here we do not make such an exaggerated calculation, but express the soft deformation of the object. to watch. </font><font style="vertical-align: inherit;">As shown in the figure, it is a transformation like a hand-drawn animation.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The sample in this chapter is </font><font style="vertical-align: inherit;">"Over Reaction" from </font></font><br><a href="https://github.com/IndieVisualLab/UnityGraphicsProgramming3" class="link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/IndieVisualLab/UnityGraphicsProgramming3</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></p>

<h2><a id="h8-1"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How to move the sample scene</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the "Over Reaction" scene, you can see the basic transformation. </font><font style="vertical-align: inherit;">Watch the object move and transform from the manipulator or Inspector.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the "Physics Scene" scene, you can apply force to the object with the up, down, left, and right keys. </font><font style="vertical-align: inherit;">If you place some objects on the scene, you can see how they transform depending on the situation.</font></font></p>

<h2><a id="h8-2"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Calculation of kinetic energy</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are many possible transformation rules, but there are probably only three basic rules.</font></font></p>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The larger the change, the greater the deformation.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When there is no change, the deformation gradually returns.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When the direction of change is reversed, the direction of deformation is also reversed.</font></font></li>
</ol>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here, we will especially consider when the object moves, so first we will detect the direction and magnitude of the movement. </font><font style="vertical-align: inherit;">Although different from the term used in the laws of physics, this parameter </font></font><code class="inline-code tt">moveEnergy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is called </font><font style="vertical-align: inherit;">"kinetic energy" for convenience </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Since kinetic energy is a parameter expressed by direction and magnitude, it can be expressed by a vector.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Kinetic energy is the correct physics term. </font><font style="vertical-align: inherit;">Here, it is named "move energy" because it is an energy that considers only movement.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is not the case as it is treated as a matter of course in game programming, but the movement of an object simply detects a change in coordinates. </font><font style="vertical-align: inherit;">The only thing I want to note is that </font></font><code class="inline-code tt">Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">it uses instead </font></font><code class="inline-code tt">FixedUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></p>
<div class="emlist-code">
<p class="caption">OverReaction.cs</p>
<pre class="emlist">protected void FixedUpdate()<font></font>
{<font></font>
    this.crntMove = this.transform.position - this.prevPosition;<font></font>
<font></font>
    UpdateMoveEnergy();<font></font>
    UpdateDeformEnergy();<font></font>
    DeformMesh();<font></font>
<font></font>
    this.prevPosition = this.transform.position;<font></font>
    this.prevMove = this.crntMove;<font></font>
}<font></font>
</pre>
</div>
<p><code class="inline-code tt">FixedUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is a method that is called at regular intervals, so it's </font></font><code class="inline-code tt">Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clearly different in nature from being </font><font style="vertical-align: inherit;">called twice or three times per second </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">I will omit the details of these differences because it is out of the main subject, but </font></font><code class="inline-code tt">FixedUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I adopted it here </font><font style="vertical-align: inherit;">because I want to support the movement of objects using PhysX (physical behavior) of Unity </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">There </font></font><code class="inline-code tt">Update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is no particular need to deform the mesh as often as.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now that the movement of the object can be calculated from the change in coordinates, let's calculate the kinetic energy. </font><font style="vertical-align: inherit;">The calculation of kinetic energy is </font></font><code class="inline-code tt">UpdateMoveEnergy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implemented in the method.</font></font></p>
<div class="emlist-code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OverReaction.cs</font></font></p>
<pre class="emlist">protected void UpdateMoveEnergy()<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
{</font></font><font></font>
    this.moveEnergy = new Vector3()<font></font>
    {<font></font>
        x = UpdateMoveEnergy<font></font>
        (this.crntMove.x, this.prevMove.x, this.moveEnergy.x),<font></font>
<font></font>
        y = UpdateMoveEnergy<font></font>
        (this.crntMove.y, this.prevMove.y, this.moveEnergy.y),<font></font>
<font></font>
        z = UpdateMoveEnergy<font></font>
        (this.crntMove.z, this.prevMove.z, this.moveEnergy.z),<font></font>
    };<font></font>
}<font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kinetic energy is calculated by decomposing into each component in the X, Y, and Z directions. </font><font style="vertical-align: inherit;">The following </font></font><code class="inline-code tt">UpdateMoveEnergy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">processes will be explained step by step.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First, consider the case where there is no current movement. </font><font style="vertical-align: inherit;">When there is no movement, the existing kinetic energy decays.</font></font></p>
<div class="emlist-code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OverReaction.cs</font></font></font></font></p>
<pre class="emlist">protected float UpdateMoveEnergy<font></font>
(float crntMove, float prevMove, float moveEnergy)<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
{</font></font></font></font><font></font>
    int crntMoveSign = Sign(crntMove);<font></font>
    int prevMoveSign = Sign(prevMove);<font></font>
    int moveEnergySign = Sign(moveEnergy);<font></font>
<font></font>
    if (crntMoveSign == 0)<font></font>
    {<font></font>
        return moveEnergy * this.undeformPower;<font></font>
    }<font></font>
…<font></font>
}<font></font>
<font></font>
public static int Sign(float value)<font></font>
{<font></font>
    return value == 0 ? 0 : (value &gt; 0 ? 1 : -1);<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font></font></font><font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When the current movement and the previous movement are reversed, the kinetic energy is reversed.</font></font></p>
<div class="emlist-code">
<p class="caption">OverReaction.cs</p>
<pre class="emlist">if (crntMoveSign != prevMoveSign)<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
{</font></font></font></font><font></font>
    return moveEnergy - crntMove;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font></font></font><font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When the current movement and the kinetic energy are reversed, reduce the kinetic energy.</font></font></p>
<div class="emlist-code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OverReaction.cs</font></font></font></font></p>
<pre class="emlist">if (crntMoveSign != moveEnergySign)<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
{</font></font></font></font><font></font>
    return moveEnergy + crntMove;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font></font></font><font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In cases other than the above, when the current movement and the kinetic energy are in the same direction, the current movement and the existing kinetic energy are compared and the larger one is adopted.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, the kinetic energy decays and becomes smaller. </font><font style="vertical-align: inherit;">In addition, the new kinetic energy generated by the current movement is increased by multiplying it by any parameter so that it can easily produce deformation.</font></font></p>
<div class="emlist-code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OverReaction.cs</font></font></font></font></p>
<pre class="emlist">if (crntMoveSign &lt; 0)<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
{</font></font></font></font><font></font>
    return Mathf.Min(crntMove * this.deformPower,<font></font>
                     moveEnergy * this.undeformPower);<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font></font></font><font></font>
else<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
{</font></font></font></font><font></font>
    return Mathf.Max(crntMove * this.deformPower,<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                     moveEnergy * this.undeformPower);</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
}</font></font></font></font><font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With this, the kinetic energy to be used for deformation could be calculated.</font></font></p>

<h2><a id="h8-3"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Calculation of deformation energy</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It then converts the calculated kinetic energy into parameters that determine the deformation. </font><font style="vertical-align: inherit;">For convenience, this parameter </font></font><code class="inline-code tt">deformEnergy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is called </font><font style="vertical-align: inherit;">"deformation energy" </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The deformation energy is </font></font><code class="inline-code tt">UpdateDeformEnergy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">updated by the method.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The magnitude of deformation energy can be defined as the magnitude of kinetic energy as it is, but if there is a discrepancy between the direction of deformation energy and the direction in which the object is moving, the deformation energy is completely in the object. I can't tell. </font><font style="vertical-align: inherit;">It is also possible that the direction of deformation energy and the direction in which the object is moving are reversed.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Therefore, the amount of deformation energy transmitted is calculated from the inner product of the deformation energy and the current movement. </font><font style="vertical-align: inherit;">If the directions are exactly the same, the inner product of the unit vectors will be 1, and will gradually approach 0 depending on the magnitude of the deviation. </font><font style="vertical-align: inherit;">When it is further inverted, it becomes a negative value.</font></font></p>
<div class="emlist-code">
<p class="caption">OverReaction.cs</p>
<pre class="emlist">protected void UpdateDeformEnergy()<font></font>
{<font></font>
    float deformEnergyVertical<font></font>
    = this.moveEnergy.magnitude<font></font>
    * Vector3.Dot(this.moveEnergy.normalized,<font></font>
                  this.crntMove.normalized);<font></font>
    …<font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now that we have calculated the force that deforms the object in the vertical direction, it deforms in the horizontal direction by the amount of change in the vertical direction. </font><font style="vertical-align: inherit;">In other words, if the object stretches vertically, it will shrink horizontally. </font><font style="vertical-align: inherit;">On the contrary, when it shrinks in the vertical direction, it should stretch in the horizontal direction.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The amount of deformation in the vertical direction is calculated by "the magnitude of the deformation in the vertical direction / the maximum magnitude of the deformation". </font><font style="vertical-align: inherit;">After that, it is calculated so that it deforms in the horizontal direction as much as it deforms in the vertical direction.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assuming that the deformation is +0.8 in the vertical direction, the deformation should be -0.8 in the horizontal direction, so the deformation energy in the horizontal direction is 1-0.8 = 0.2. </font><font style="vertical-align: inherit;">Also, as the coefficient for actual deformation, * 0.8 is small, so add 1 to make it * 1.8.</font></font></p>
<div class="emlist-code">
<p class="caption">OverReaction.cs</p>
<pre class="emlist">protected void UpdateDeformEnergy()<font></font>
{<font></font>
…<font></font>
    float deformEnergyHorizontalRatio<font></font>
    = deformEnergyVertical / this.maxDeformScale;<font></font>
<font></font>
    float deformEnergyHorizontal<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    = 1 - deformEnergyHorizontalRatio;</font></font></font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
…</font></font></font></font><font></font>
    deformEnergyVertical = 1 + deformEnergyVertical;<font></font>
}<font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finally, consider the case where the object collapses in the direction of travel. </font><font style="vertical-align: inherit;">The case where the object collapses in the direction of travel is when the kinetic energy and the current movement are reversed, that is, when the previous "inner product of the kinetic energy and the current movement" is negative.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When the value of the inner product is negative, the deformation energy in the vertical direction and the deformation energy in the horizontal direction are reversed.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To help you understand the case, the following code is a continuation of the previous steps. </font><font style="vertical-align: inherit;">When the dot product value is negative, </font></font><code class="inline-code tt">deformEnergyHorizontal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is a positive value greater than 1. </font><font style="vertical-align: inherit;">Or </font></font><code class="inline-code tt">deformEnergyVertical</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is </font></font><code class="inline-code tt">deformEnergyHorizontal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">of value reversed with, it will be one less than the positive value.</font></font></p>
<div class="emlist-code">
<p class="caption"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OverReaction.cs</font></font></font></font></p>
<pre class="emlist"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">protected void UpdateDeformEnergy()</font></font></font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
{</font></font></font></font><font></font>
    float deformEnergyVertical<font></font>
    = this.moveEnergy.magnitude<font></font>
    * Vector3.Dot(this.moveEnergy.normalized,<font></font>
                  this.crntMove.normalized);<font></font>
<font></font>
    float deformEnergyHorizontalRatio<font></font>
    = deformEnergyVertical / this.maxDeformScale;<font></font>
<font></font>
    float deformEnergyHorizontal<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    = 1 - deformEnergyHorizontalRatio;</font></font></font></font><font></font>
<font></font>
    if (deformEnergyVertical &lt; 0)<font></font>
    {<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        deformEnergyVertical = deformEnergyHorizontalRatio;</font></font></font></font><font></font>
    }<font></font>
<font></font>
    deformEnergyVertical = 1 + deformEnergyVertical;<font></font>
…<font></font>
</pre>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finally, correct the value so that the deformation energy falls within the arbitrarily set range, and complete the calculation of the deformation energy.</font></font></p>
<div class="emlist-code">
<p class="caption">OverReaction.cs</p>
<pre class="emlist">deformEnergyVertical = Mathf.Clamp(deformEnergyVertical,<font></font>
                                    this.minDeformScale,<font></font>
                                    this.maxDeformScale);<font></font>
<font></font>
deformEnergyHorizontal = Mathf.Clamp(deformEnergyHorizontal,<font></font>
                                        this.minDeformScale,<font></font>
                                        this.maxDeformScale);<font></font>
<font></font>
this.deformEnergy = new Vector3(deformEnergyHorizontal,<font></font>
                                deformEnergyVertical,<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                                deformEnergyHorizontal);</font></font></font></font><font></font>
</pre>
</div>

<h2><a id="h8-4"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.4　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Transform the mesh</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here, the mesh is transformed with a script for explanation and generalization. </font><font style="vertical-align: inherit;">The transformation of the mesh is </font></font><code class="inline-code tt">DeformMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implemented in the method.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Since it is a matrix operation, it is often better to process it on the GPU using a shader for practical purposes.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The obtained deformation energy </font></font><code class="inline-code tt">deformEnergy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is </font></font><code class="inline-code tt">moveEnergy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a vector representing expansion and contraction when facing the direction of </font><font style="vertical-align: inherit;">kinetic energy </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Therefore, when transforming, it is necessary to match the coordinates before transforming. </font><font style="vertical-align: inherit;">First, suppress the parameters required for that purpose. </font><font style="vertical-align: inherit;">The rotation matrix of the current object and its inverse matrix, the kinetic energy </font></font><code class="inline-code tt">moveEnergy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rotation matrix and its inverse matrix.</font></font></p>
<div class="emlist-code">
<p class="caption">OverReaction.cs</p>
<pre class="emlist">protected void DeformMesh()<font></font>
{<font></font>
Vector3[] deformedVertices = new Vector3[this.baseVertices.Length];<font></font>
<font></font>
Quaternion crntRotation  = this.transform.localRotation;<font></font>
Quaternion crntRotationI = Quaternion.Inverse(crntRotation);<font></font>
<font></font>
Quaternion moveEnergyRotation<font></font>
= Quaternion.FromToRotation(Vector3.up, this.moveEnergy.normalized);<font></font>
Quaternion moveEnergyRotationI = Quaternion.Inverse(moveEnergyRotation);<font></font>
…<font></font>
</pre>
</div>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Multiplies the current rotation matrix by the vertices of the unrotated mesh to rotate.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Multiply the vertices by the inverse matrix of the rotation matrix that indicates the direction of movement and rotate.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scales </font></font><code class="inline-code tt">deformEnergy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">according to the </font><font style="vertical-align: inherit;">vertices </font><font style="vertical-align: inherit;">.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Multiplies the vertices by the rotation matrix that indicates the direction of movement to restore the rotation.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Multiplies the vertices by the inverse of the current rotation matrix to restore the rotation.</font></font></li>
</ol>
<p><font style="vertical-align: inherit;"></font><code class="inline-code tt">deformEnergy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you give an </font><font style="vertical-align: inherit;">appropriate deformation energy </font><font style="vertical-align: inherit;">in </font><font style="vertical-align: inherit;">an easy-to-understand manner </font><font style="vertical-align: inherit;">and comment out the source code in sequence, the processing procedure will be easier to understand.</font></font></p>
<div class="emlist-code">
<p class="caption">OverReaction.cs</p>
<pre class="emlist">for (int i = 0; i &lt; this.baseVertices.Length; i++)<font></font>
{<font></font>
    deformedVertices[i] = this.baseVertices[i];<font></font>
    deformedVertices[i] = crntRotation * deformedVertices[i];<font></font>
    deformedVertices[i] = moveEnergyRotationI * deformedVertices[i];<font></font>
    deformedVertices[i] = new Vector3(<font></font>
        deformedVertices[i].x * this.deformEnergy.x,<font></font>
        deformedVertices[i].y * this.deformEnergy.y,<font></font>
        deformedVertices[i].z * this.deformEnergy.z);<font></font>
    deformedVertices[i] = moveEnergyRotation * deformedVertices[i];<font></font>
    deformedVertices[i] = crntRotationI * deformedVertices[i];<font></font>
}<font></font>
<font></font>
this.baseMesh.vertices = deformedVertices;<font></font>
</pre>
</div>

<h2><a id="h8-5"></a><span class="secno"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.5　</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Summary</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I was able to transform the object with a very simple implementation. </font><font style="vertical-align: inherit;">Although it is so easy to implement, the impression it gives to the appearance changes greatly.</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Although the calculation cost is higher, it is possible to support the rotation and enlargement / reduction of the object, move the center of gravity of the deformation, and support the skin mesh animation as an advanced form.</font></font></p></body></html>